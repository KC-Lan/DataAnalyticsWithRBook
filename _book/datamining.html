<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>資料科學與R語言</title>
  <meta name="description" content="長庚大學資訊管理學系大數據分析方法課程教學使用書籍">
  <meta name="generator" content="bookdown 0.3.9 and GitBook 2.6.7">

  <meta property="og:title" content="資料科學與R語言" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="長庚大學資訊管理學系大數據分析方法課程教學使用書籍" />
  <meta name="github-repo" content="yijutseng/DataAnalyticsWithRBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="資料科學與R語言" />
  
  <meta name="twitter:description" content="長庚大學資訊管理學系大數據分析方法課程教學使用書籍" />
  

<meta name="author" content="曾意儒 Yi-Ju Tseng">


<meta name="date" content="2017-02-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="InteractiveGraphics.html">
<link rel="next" href="big.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">資料科學與R語言</a></li>

<li class="divider"></li>
<li><a href="index.html#preface"></a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R語言101</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.1</b> 什麼是R語言</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 函數使用</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 變數設定</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 執行視窗</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#DataType"><i class="fa fa-check"></i><b>1.5</b> 資料型態</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#-numeric"><i class="fa fa-check"></i><b>1.5.1</b> 數值 numeric</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#-character"><i class="fa fa-check"></i><b>1.5.2</b> 字串 character</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#-logic"><i class="fa fa-check"></i><b>1.5.3</b> 布林變數 logic</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#-date"><i class="fa fa-check"></i><b>1.5.4</b> 日期 (Date)</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#section-1.6"><i class="fa fa-check"></i><b>1.6</b> 基本運算子</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#section-1.6.1"><i class="fa fa-check"></i><b>1.6.1</b> 數學基本運算</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#section-1.6.2"><i class="fa fa-check"></i><b>1.6.2</b> 進階數學函數</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#section-1.6.3"><i class="fa fa-check"></i><b>1.6.3</b> 邏輯運算</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#section-1.7"><i class="fa fa-check"></i><b>1.7</b> 錯誤訊息</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#help"><i class="fa fa-check"></i><b>1.8</b> Help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RDataStructure.html"><a href="RDataStructure.html"><i class="fa fa-check"></i><b>2</b> R 資料結構</a><ul>
<li class="chapter" data-level="2.1" data-path="RDataStructure.html"><a href="RDataStructure.html#-vector"><i class="fa fa-check"></i><b>2.1</b> 向量 vector</a><ul>
<li class="chapter" data-level="2.1.1" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.1.1"><i class="fa fa-check"></i><b>2.1.1</b> 快速產生向量函數</a></li>
<li class="chapter" data-level="2.1.2" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.1.2"><i class="fa fa-check"></i><b>2.1.2</b> 向量運算</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="RDataStructure.html"><a href="RDataStructure.html#-factor"><i class="fa fa-check"></i><b>2.2</b> 因子 factor</a></li>
<li class="chapter" data-level="2.3" data-path="RDataStructure.html"><a href="RDataStructure.html#-list"><i class="fa fa-check"></i><b>2.3</b> 列表 list</a><ul>
<li class="chapter" data-level="2.3.1" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.3.1"><i class="fa fa-check"></i><b>2.3.1</b> 列表資料擷取</a></li>
<li class="chapter" data-level="2.3.2" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.3.2"><i class="fa fa-check"></i><b>2.3.2</b> 列表資料編輯設定</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="RDataStructure.html"><a href="RDataStructure.html#-matrix"><i class="fa fa-check"></i><b>2.4</b> 矩陣 matrix</a></li>
<li class="chapter" data-level="2.5" data-path="RDataStructure.html"><a href="RDataStructure.html#-data.frame"><i class="fa fa-check"></i><b>2.5</b> 資料框 data.frame</a></li>
<li class="chapter" data-level="2.6" data-path="RDataStructure.html"><a href="RDataStructure.html#-data.table"><i class="fa fa-check"></i><b>2.6</b> 資料表 data.table</a></li>
<li class="chapter" data-level="2.7" data-path="RDataStructure.html"><a href="RDataStructure.html#section-2.7"><i class="fa fa-check"></i><b>2.7</b> 資料屬性查詢函數</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="controlstructure.html"><a href="controlstructure.html"><i class="fa fa-check"></i><b>3</b> 控制流程</a><ul>
<li class="chapter" data-level="3.1" data-path="controlstructure.html"><a href="controlstructure.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 條件判斷</a><ul>
<li class="chapter" data-level="3.1.1" data-path="controlstructure.html"><a href="controlstructure.html#if-else"><i class="fa fa-check"></i><b>3.1.1</b> if-else敘述</a></li>
<li class="chapter" data-level="3.1.2" data-path="controlstructure.html"><a href="controlstructure.html#if-else-if-else"><i class="fa fa-check"></i><b>3.1.2</b> if-else if-else</a></li>
<li class="chapter" data-level="3.1.3" data-path="controlstructure.html"><a href="controlstructure.html#if"><i class="fa fa-check"></i><b>3.1.3</b> 巢狀if</a></li>
<li class="chapter" data-level="3.1.4" data-path="controlstructure.html"><a href="controlstructure.html#ifelse"><i class="fa fa-check"></i><b>3.1.4</b> ifelse()</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="controlstructure.html"><a href="controlstructure.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 迴圈</a><ul>
<li class="chapter" data-level="3.2.1" data-path="controlstructure.html"><a href="controlstructure.html#for"><i class="fa fa-check"></i><b>3.2.1</b> for</a></li>
<li class="chapter" data-level="3.2.2" data-path="controlstructure.html"><a href="controlstructure.html#while"><i class="fa fa-check"></i><b>3.2.2</b> while</a></li>
<li class="chapter" data-level="3.2.3" data-path="controlstructure.html"><a href="controlstructure.html#break"><i class="fa fa-check"></i><b>3.2.3</b> break</a></li>
<li class="chapter" data-level="3.2.4" data-path="controlstructure.html"><a href="controlstructure.html#next"><i class="fa fa-check"></i><b>3.2.4</b> next</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>4</b> 資料讀取與匯出</a><ul>
<li class="chapter" data-level="4.1" data-path="io.html"><a href="io.html#file"><i class="fa fa-check"></i><b>4.1</b> 從檔案匯入基本資料格式</a><ul>
<li class="chapter" data-level="4.1.1" data-path="io.html"><a href="io.html#import-dataset-rstudio"><i class="fa fa-check"></i><b>4.1.1</b> Import Dataset功能 (RStudio)</a></li>
<li class="chapter" data-level="4.1.2" data-path="io.html"><a href="io.html#-.txt"><i class="fa fa-check"></i><b>4.1.2</b> 分隔文字檔 .txt</a></li>
<li class="chapter" data-level="4.1.3" data-path="io.html"><a href="io.html#csv"><i class="fa fa-check"></i><b>4.1.3</b> CSV檔案 .csv</a></li>
<li class="chapter" data-level="4.1.4" data-path="io.html"><a href="io.html#excel-.xls"><i class="fa fa-check"></i><b>4.1.4</b> Excel檔案 .xls</a></li>
<li class="chapter" data-level="4.1.5" data-path="io.html"><a href="io.html#r-.rds"><i class="fa fa-check"></i><b>4.1.5</b> R物件 .rds</a></li>
<li class="chapter" data-level="4.1.6" data-path="io.html"><a href="io.html#r-.r"><i class="fa fa-check"></i><b>4.1.6</b> R程式 .R</a></li>
<li class="chapter" data-level="4.1.7" data-path="io.html"><a href="io.html#-"><i class="fa fa-check"></i><b>4.1.7</b> 純文字資料 (無分隔)</a></li>
<li class="chapter" data-level="4.1.8" data-path="io.html"><a href="io.html#section-4.1.8"><i class="fa fa-check"></i><b>4.1.8</b> 其他格式</a></li>
<li class="chapter" data-level="4.1.9" data-path="io.html"><a href="io.html#section-4.1.9"><i class="fa fa-check"></i><b>4.1.9</b> 其他讀檔注意事項</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="io.html"><a href="io.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 從網路匯入資料</a><ul>
<li class="chapter" data-level="4.2.1" data-path="io.html"><a href="io.html#open-data"><i class="fa fa-check"></i><b>4.2.1</b> Open Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="io.html"><a href="io.html#api"><i class="fa fa-check"></i><b>4.2.2</b> API (Application programming interfaces)</a></li>
<li class="chapter" data-level="4.2.3" data-path="io.html"><a href="io.html#json"><i class="fa fa-check"></i><b>4.2.3</b> JSON格式檔案</a></li>
<li class="chapter" data-level="4.2.4" data-path="io.html"><a href="io.html#xml"><i class="fa fa-check"></i><b>4.2.4</b> XML 可延伸標記式語言</a></li>
<li class="chapter" data-level="4.2.5" data-path="io.html"><a href="io.html#-webscraping"><i class="fa fa-check"></i><b>4.2.5</b> 網頁爬蟲 Webscraping</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="io.html"><a href="io.html#facebook"><i class="fa fa-check"></i><b>4.3</b> Facebook資料擷取</a><ul>
<li class="chapter" data-level="4.3.1" data-path="io.html"><a href="io.html#graph-api-in-r"><i class="fa fa-check"></i><b>4.3.1</b> Graph API in R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="io.html"><a href="io.html#section-4.4"><i class="fa fa-check"></i><b>4.4</b> 資料匯出</a><ul>
<li class="chapter" data-level="4.4.1" data-path="io.html"><a href="io.html#-.txt"><i class="fa fa-check"></i><b>4.4.1</b> 文字檔 .txt</a></li>
<li class="chapter" data-level="4.4.2" data-path="io.html"><a href="io.html#csv-.csv"><i class="fa fa-check"></i><b>4.4.2</b> CSV檔 .csv</a></li>
<li class="chapter" data-level="4.4.3" data-path="io.html"><a href="io.html#r-.rds-1"><i class="fa fa-check"></i><b>4.4.3</b> R物件 .rds</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulation.html"><a href="manipulation.html"><i class="fa fa-check"></i><b>5</b> 資料處理與清洗</a><ul>
<li class="chapter" data-level="5.1" data-path="manipulation.html"><a href="manipulation.html#tidy-data"><i class="fa fa-check"></i><b>5.1</b> Tidy Data</a></li>
<li class="chapter" data-level="5.2" data-path="manipulation.html"><a href="manipulation.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 資料型別轉換處理</a><ul>
<li class="chapter" data-level="5.2.1" data-path="manipulation.html"><a href="manipulation.html#section-5.2.1"><i class="fa fa-check"></i><b>5.2.1</b> 資料型別檢查</a></li>
<li class="chapter" data-level="5.2.2" data-path="manipulation.html"><a href="manipulation.html#section-5.2.2"><i class="fa fa-check"></i><b>5.2.2</b> 資料型別轉換</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="manipulation.html"><a href="manipulation.html#section-5.3"><i class="fa fa-check"></i><b>5.3</b> 文字字串處理</a><ul>
<li class="chapter" data-level="5.3.1" data-path="manipulation.html"><a href="manipulation.html#section-5.3.1"><i class="fa fa-check"></i><b>5.3.1</b> 基本處理</a></li>
<li class="chapter" data-level="5.3.2" data-path="manipulation.html"><a href="manipulation.html#section-5.3.2"><i class="fa fa-check"></i><b>5.3.2</b> 搜尋字串</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="manipulation.html"><a href="manipulation.html#subset"><i class="fa fa-check"></i><b>5.4</b> 子集Subset</a><ul>
<li class="chapter" data-level="5.4.1" data-path="io.html"><a href="io.html#-"><i class="fa fa-check"></i><b>5.4.1</b> 一維資料 (向量)</a></li>
<li class="chapter" data-level="5.4.2" data-path="manipulation.html"><a href="manipulation.html#section-5.4.2"><i class="fa fa-check"></i><b>5.4.2</b> 二維資料</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="manipulation.html"><a href="manipulation.html#section-5.5"><i class="fa fa-check"></i><b>5.5</b> 排序</a><ul>
<li class="chapter" data-level="5.5.1" data-path="manipulation.html"><a href="manipulation.html#sort-"><i class="fa fa-check"></i><b>5.5.1</b> sort 向量排序</a></li>
<li class="chapter" data-level="5.5.2" data-path="manipulation.html"><a href="manipulation.html#order"><i class="fa fa-check"></i><b>5.5.2</b> order</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="manipulation.html"><a href="manipulation.html#section-5.6"><i class="fa fa-check"></i><b>5.6</b> 資料組合</a></li>
<li class="chapter" data-level="5.7" data-path="manipulation.html"><a href="manipulation.html#section-5.7"><i class="fa fa-check"></i><b>5.7</b> 長表與寬表</a></li>
<li class="chapter" data-level="5.8" data-path="manipulation.html"><a href="manipulation.html#section-5.8"><i class="fa fa-check"></i><b>5.8</b> 遺漏值處理</a></li>
<li class="chapter" data-level="5.9" data-path="manipulation.html"><a href="manipulation.html#manCase"><i class="fa fa-check"></i><b>5.9</b> 綜合練習範例Case study</a><ul>
<li class="chapter" data-level="5.9.1" data-path="manipulation.html"><a href="manipulation.html#section-5.9.1"><i class="fa fa-check"></i><b>5.9.1</b> 載入資料</a></li>
<li class="chapter" data-level="5.9.2" data-path="manipulation.html"><a href="manipulation.html#section-5.9.2"><i class="fa fa-check"></i><b>5.9.2</b> 資料總覽</a></li>
<li class="chapter" data-level="5.9.3" data-path="manipulation.html"><a href="manipulation.html#section-5.9.3"><i class="fa fa-check"></i><b>5.9.3</b> 資料排序後篩選</a></li>
<li class="chapter" data-level="5.9.4" data-path="manipulation.html"><a href="manipulation.html#section-5.9.4"><i class="fa fa-check"></i><b>5.9.4</b> 欄位值篩選</a></li>
<li class="chapter" data-level="5.9.5" data-path="manipulation.html"><a href="manipulation.html#section-5.9.5"><i class="fa fa-check"></i><b>5.9.5</b> 字串條件搜尋後篩選</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>6</b> 探索式資料分析</a><ul>
<li class="chapter" data-level="6.1" data-path="eda.html"><a href="eda.html#datatable"><i class="fa fa-check"></i><b>6.1</b> data.table</a><ul>
<li class="chapter" data-level="6.1.1" data-path="eda.html"><a href="eda.html#i-"><i class="fa fa-check"></i><b>6.1.1</b> i 觀察值篩選邏輯</a></li>
<li class="chapter" data-level="6.1.2" data-path="eda.html"><a href="eda.html#j-"><i class="fa fa-check"></i><b>6.1.2</b> j 欄位選擇運算</a></li>
<li class="chapter" data-level="6.1.3" data-path="eda.html"><a href="eda.html#by-"><i class="fa fa-check"></i><b>6.1.3</b> by 分組依據</a></li>
<li class="chapter" data-level="6.1.4" data-path="eda.html"><a href="eda.html#section-6.1.4"><i class="fa fa-check"></i><b>6.1.4</b> 參考文件與資源</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="eda.html"><a href="eda.html#dplyr"><i class="fa fa-check"></i><b>6.2</b> dplyr</a><ul>
<li class="chapter" data-level="6.2.1" data-path="eda.html"><a href="eda.html#select"><i class="fa fa-check"></i><b>6.2.1</b> select()</a></li>
<li class="chapter" data-level="6.2.2" data-path="eda.html"><a href="eda.html#filter"><i class="fa fa-check"></i><b>6.2.2</b> filter()</a></li>
<li class="chapter" data-level="6.2.3" data-path="eda.html"><a href="eda.html#mutate"><i class="fa fa-check"></i><b>6.2.3</b> mutate()</a></li>
<li class="chapter" data-level="6.2.4" data-path="eda.html"><a href="eda.html#summarise"><i class="fa fa-check"></i><b>6.2.4</b> summarise()</a></li>
<li class="chapter" data-level="6.2.5" data-path="eda.html"><a href="eda.html#group_by"><i class="fa fa-check"></i><b>6.2.5</b> group_by()</a></li>
<li class="chapter" data-level="6.2.6" data-path="eda.html"><a href="eda.html#arrange"><i class="fa fa-check"></i><b>6.2.6</b> arrange()</a></li>
<li class="chapter" data-level="6.2.7" data-path="eda.html"><a href="eda.html#rename"><i class="fa fa-check"></i><b>6.2.7</b> rename()</a></li>
<li class="chapter" data-level="6.2.8" data-path="eda.html"><a href="eda.html#-1"><i class="fa fa-check"></i><b>6.2.8</b> 參考文件與資源</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>7</b> 資料視覺化</a><ul>
<li class="chapter" data-level="7.1" data-path="vis.html"><a href="vis.html#ggplot2"><i class="fa fa-check"></i><b>7.1</b> ggplot2套件</a><ul>
<li class="chapter" data-level="7.1.1" data-path="vis.html"><a href="vis.html#qplot"><i class="fa fa-check"></i><b>7.1.1</b> qplot()</a></li>
<li class="chapter" data-level="7.1.2" data-path="vis.html"><a href="vis.html#ggplot"><i class="fa fa-check"></i><b>7.1.2</b> ggplot()</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="vis.html"><a href="vis.html#ggplot2"><i class="fa fa-check"></i><b>7.2</b> ggplot2+地圖</a><ul>
<li class="chapter" data-level="7.2.1" data-path="vis.html"><a href="vis.html#choropleth-map"><i class="fa fa-check"></i><b>7.2.1</b> Choropleth map</a></li>
<li class="chapter" data-level="7.2.2" data-path="vis.html"><a href="vis.html#ggmap"><i class="fa fa-check"></i><b>7.2.2</b> ggmap</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="vis.html"><a href="vis.html#taiwan"><i class="fa fa-check"></i><b>7.3</b> Taiwan的面量圖</a><ul>
<li class="chapter" data-level="7.3.1" data-path="vis.html"><a href="vis.html#taiwan-1"><i class="fa fa-check"></i><b>7.3.1</b> Taiwan的面量圖</a></li>
<li class="chapter" data-level="7.3.2" data-path="vis.html"><a href="vis.html#heatmap-"><i class="fa fa-check"></i><b>7.3.2</b> Heatmap 先將資料讀入</a></li>
<li class="chapter" data-level="7.3.3" data-path="vis.html"><a href="vis.html#treemap"><i class="fa fa-check"></i><b>7.3.3</b> Treemap</a></li>
<li class="chapter" data-level="7.3.4" data-path="vis.html"><a href="vis.html#error-bar-"><i class="fa fa-check"></i><b>7.3.4</b> Error bar 誤差線</a></li>
<li class="chapter" data-level="7.3.5" data-path="vis.html"><a href="vis.html#-2"><i class="fa fa-check"></i><b>7.3.5</b> 參考文件與資源</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="vis.html"><a href="vis.html#case-study"><i class="fa fa-check"></i><b>7.4</b> Case study</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="InteractiveGraphics.html"><a href="InteractiveGraphics.html"><i class="fa fa-check"></i><b>8</b> 互動式資料呈現</a></li>
<li class="chapter" data-level="9" data-path="datamining.html"><a href="datamining.html"><i class="fa fa-check"></i><b>9</b> 資料探勘</a><ul>
<li class="chapter" data-level="9.1" data-path="datamining.html"><a href="datamining.html#clustering"><i class="fa fa-check"></i><b>9.1</b> Clustering</a></li>
<li class="chapter" data-level="9.2" data-path="datamining.html"><a href="datamining.html#hierarchical-clustering"><i class="fa fa-check"></i><b>9.2</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="9.3" data-path="datamining.html"><a href="datamining.html#k-means-clustering"><i class="fa fa-check"></i><b>9.3</b> K-means clustering</a></li>
<li class="chapter" data-level="9.4" data-path="datamining.html"><a href="datamining.html#kmeans"><i class="fa fa-check"></i><b>9.4</b> <code>kmeans()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="datamining.html"><a href="datamining.html#heatmaps"><i class="fa fa-check"></i><b>9.4.1</b> Heatmaps</a></li>
<li class="chapter" data-level="9.4.2" data-path="datamining.html"><a href="datamining.html#k-means"><i class="fa fa-check"></i><b>9.4.2</b> K-means注意事項</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="datamining.html"><a href="datamining.html#machine-learning-"><i class="fa fa-check"></i><b>9.5</b> Machine Learning 機器學習</a></li>
<li class="chapter" data-level="9.6" data-path="datamining.html"><a href="datamining.html#decision-trees-"><i class="fa fa-check"></i><b>9.6</b> Decision Trees 決策樹</a></li>
<li class="chapter" data-level="9.7" data-path="datamining.html"><a href="datamining.html#association-rules-"><i class="fa fa-check"></i><b>9.7</b> Association Rules 關聯式規則</a><ul>
<li class="chapter" data-level="9.7.1" data-path="datamining.html"><a href="datamining.html#section-9.7.1"><i class="fa fa-check"></i><b>9.7.1</b> 參考資料</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="datamining.html"><a href="datamining.html#regression-"><i class="fa fa-check"></i><b>9.8</b> Regression 迴歸</a></li>
<li class="chapter" data-level="9.9" data-path="datamining.html"><a href="datamining.html#logistic-regression-"><i class="fa fa-check"></i><b>9.9</b> Logistic Regression 邏輯迴歸</a></li>
<li class="chapter" data-level="9.10" data-path="datamining.html"><a href="datamining.html#decision-trees--1"><i class="fa fa-check"></i><b>9.10</b> Decision Trees 決策樹</a><ul>
<li class="chapter" data-level="9.10.1" data-path="datamining.html"><a href="datamining.html#section-9.10.1"><i class="fa fa-check"></i><b>9.10.1</b> 模型驗證</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big.html"><a href="big.html"><i class="fa fa-check"></i><b>10</b> 從小數據到大數據分析</a><ul>
<li class="chapter" data-level="10.1" data-path="big.html"><a href="big.html#r-hadoop"><i class="fa fa-check"></i><b>10.1</b> R + Hadoop</a></li>
<li class="chapter" data-level="10.2" data-path="big.html"><a href="big.html#rhadoop-cloudera"><i class="fa fa-check"></i><b>10.2</b> RHadoop安裝測試流程 (Cloudera)</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big.html"><a href="big.html#section-10.2.1"><i class="fa fa-check"></i><b>10.2.1</b> 系統/軟體版本資訊</a></li>
<li class="chapter" data-level="10.2.2" data-path="eda.html"><a href="eda.html#-1"><i class="fa fa-check"></i><b>10.2.2</b> 參考資料</a></li>
<li class="chapter" data-level="10.2.3" data-path="big.html"><a href="big.html#section-10.2.3"><i class="fa fa-check"></i><b>10.2.3</b> 安裝步驟</a></li>
<li class="chapter" data-level="10.2.4" data-path="big.html"><a href="big.html#section-10.2.4"><i class="fa fa-check"></i><b>10.2.4</b> 測試前，先解決權限問題</a></li>
<li class="chapter" data-level="10.2.5" data-path="big.html"><a href="big.html#section-10.2.5"><i class="fa fa-check"></i><b>10.2.5</b> 測試</a></li>
<li class="chapter" data-level="10.2.6" data-path="big.html"><a href="big.html#rstudio-server"><i class="fa fa-check"></i><b>10.2.6</b> 安裝RStudio Server</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="big.html"><a href="big.html#rhadoop-mapreduce-easy-word-count"><i class="fa fa-check"></i><b>10.3</b> RHadoop MapReduce: easy word count</a></li>
<li class="chapter" data-level="10.4" data-path="big.html"><a href="big.html#r-spark"><i class="fa fa-check"></i><b>10.4</b> R + Spark</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>11</b> 軟體安裝介紹</a><ul>
<li class="chapter" data-level="11.1" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>11.1</b> R安裝</a></li>
<li class="chapter" data-level="11.2" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>11.2</b> RStudio安裝</a></li>
<li class="chapter" data-level="11.3" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>11.3</b> RStudio使用簡介</a><ul>
<li class="chapter" data-level="11.3.1" data-path="install.html"><a href="install.html#section-11.3.1"><i class="fa fa-check"></i><b>11.3.1</b> 專案</a></li>
<li class="chapter" data-level="11.3.2" data-path="install.html"><a href="install.html#rstudio"><i class="fa fa-check"></i><b>11.3.2</b> RStudio介面</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者資訊</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">資料科學與R語言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datamining" class="section level1">
<h1><span class="header-section-number">9</span> 資料探勘</h1>
<p>撰寫中</p>
<div id="clustering" class="section level2">
<h2><span class="header-section-number">9.1</span> Clustering</h2>
<p>汽車基本資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars.mx&lt;-<span class="kw">as.matrix</span>(mtcars)
mtcars.mxs&lt;-<span class="kw">scale</span>(mtcars.mx)
<span class="co">#[, 1]  mpg Miles/(US) gallon</span>
<span class="co">#[, 2]  cyl Number of cylinders 氣缸數</span>
<span class="co">#[, 3]  disp    Displacement (cu.in.) 排氣量</span>
<span class="co">#[, 4]  hp  Gross horsepower 馬力</span>
<span class="co">#[, 5]  drat    Rear axle ratio 後輪軸比</span>
<span class="co">#[, 6]  wt  Weight (1000 lbs)</span>
<span class="co">#[, 7]  qsec    1/4 mile time</span>
<span class="co">#[, 8]  vs  V/S</span>
<span class="co">#[, 9]  am  Transmission (0 = automatic, 1 = manual)</span>
<span class="co">#[,10]  gear    Number of forward gears 前進檔</span>
<span class="co">#[,11]  carb    Number of carburetors 化油器</span>
<span class="kw">head</span>(mtcars.mxs,<span class="dv">3</span>)</code></pre></div>
<pre><code>##                  mpg    cyl    disp      hp   drat      wt    qsec     vs   am
## Mazda RX4     0.1509 -0.105 -0.5706 -0.5351 0.5675 -0.6104 -0.7772 -0.868 1.19
## Mazda RX4 Wag 0.1509 -0.105 -0.5706 -0.5351 0.5675 -0.3498 -0.4638 -0.868 1.19
## Datsun 710    0.4495 -1.225 -0.9902 -0.7830 0.4740 -0.9170  0.4260  1.116 1.19
##                 gear    carb
## Mazda RX4     0.4236  0.7352
## Mazda RX4 Wag 0.4236  0.7352
## Datsun 710    0.4236 -1.1222</code></pre>
<p>各汽車/參數間的相似性？ -heatmap()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.2</span>,<span class="dv">4</span>),<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="kw">heatmap</span>(mtcars.mxs)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-169-1.png" width="576" /></p>
<p>如何找到相似的物件/事件？</p>
<p>Clustering organizes things that are <code>close</code> into groups</p>
<ul>
<li>How do we define close?</li>
<li>How do we group things?</li>
<li>How do we visualize the grouping?</li>
<li>How do we interpret the grouping?</li>
</ul>
<p>Hierarchical clustering</p>
<ul>
<li>An agglomerative approach
<ul>
<li>Find closest two things</li>
<li>Put them together</li>
<li>Find next closest</li>
</ul></li>
<li>Requires
<ul>
<li>A defined distance</li>
<li>A merging approach</li>
</ul></li>
<li>Produces
<ul>
<li>A tree showing how close things are to each other</li>
</ul></li>
</ul>
<p>Hierarchical clustering</p>
<ul>
<li>An agglomerative approach
<ul>
<li>Find closest two things</li>
<li>Put them together</li>
<li>Find next closest</li>
</ul></li>
<li>Requires
<ul>
<li><code>A defined distance</code></li>
<li>A merging approach</li>
</ul></li>
<li>Produces
<ul>
<li>A tree showing how close things are to each other</li>
</ul></li>
</ul>
<p>How do we define close? <code>distance</code></p>
<ul>
<li>Most important step
<ul>
<li>Garbage in -&gt; garbage out</li>
</ul></li>
<li>Distance or similarity
<ul>
<li>Continuous - euclidean distance</li>
<li>Continuous - correlation similarity</li>
<li>Binary - manhattan distance</li>
</ul></li>
<li>Pick a distance/similarity that makes sense for your problem</li>
</ul>
<p>Example distances - Euclidean</p>
<p><span class="math display">\[\sqrt{(A_1-A_2)^2 + (B_1-B_2)^2 + \ldots + (Z_1-Z_2)^2}\]</span></p>
<p><img src="Fig/ED.jpg" width="600px"></p>
<p>Example distances - Manhattan</p>
<p><span class="math display">\[|A_1-A_2| + |B_1-B_2| + \ldots + |Z_1-Z_2|\]</span></p>
<p><img src="Fig/MD.png" width="300px"><img src="Fig/MD1.png" width="300px"></p>
<p>Green line: Euclidean, Blue line: Manhattan</p>
</div>
<div id="hierarchical-clustering" class="section level2">
<h2><span class="header-section-number">9.2</span> Hierarchical clustering</h2>
<ul>
<li>An agglomerative approach
<ul>
<li>Find closest two things</li>
<li>Put them together</li>
<li>Find next closest</li>
</ul></li>
<li>Requires
<ul>
<li>A defined distance</li>
<li><code>A merging approach</code></li>
</ul></li>
<li>Produces
<ul>
<li>A tree showing how close things are to each other</li>
</ul></li>
</ul>
<p>Merging apporach - Agglomerative 聚合 - Single-linkage：取最小值 - Complete-linkage：取最大值 - Average-linkage：取平均值</p>
<p><img src="Fig/Agg.JPG" width="700px"></p>
<p>Hierarchical clustering - hp vs. mpg <img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-170-1.png" width="768" /></p>
<p>Hierarchical clustering - #1</p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-171-1.png" width="768" /></p>
<p>Hierarchical clustering - #2 <img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-172-1.png" width="768" /></p>
<p>Hierarchical clustering - #3</p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-173-1.png" width="768" /></p>
<p>Hierarchical clustering</p>
<ul>
<li>An agglomerative approach
<ul>
<li>Find closest two things</li>
<li>Put them together</li>
<li>Find next closest</li>
</ul></li>
<li><code>Requires</code>
<ul>
<li>A defined distance</li>
<li>A merging approach</li>
</ul></li>
<li>Produces
<ul>
<li>A tree showing how close things are to each other</li>
</ul></li>
</ul>
<p>Hierarchical Clustering -dist() 用<code>dist()</code>函數計算距離，使用method=“”設定計算距離的依據</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d&lt;-<span class="kw">dist</span>(mtcars.mxs) <span class="co">#預設為euclidean</span>
d</code></pre></div>
<pre><code>##                     Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive
## Mazda RX4 Wag          0.4076                                        
## Datsun 710             3.2431        3.1764                          
## Hornet 4 Drive         4.4014        4.2633     3.4371               
## Hornet Sportabout      3.8804        3.8197     5.0033         3.0422
## Valiant                4.8437        4.6756     3.8681         0.9937
## Duster 360             4.1896        4.1749     5.8959         4.3396
## Merc 240D              3.9973        3.8208     2.5014         2.5336
## Merc 230               4.9177        4.6700     3.3122         3.2699
## Merc 280               3.1378        2.9882     3.2950         2.9860
## Merc 280C              3.2928        3.1171     3.3444         2.9705
## Merc 450SE             3.8563        3.7330     5.1668         3.2469
## Merc 450SL             3.7265        3.6141     5.0139         3.0963
## Merc 450SLC            3.8588        3.7280     5.0837         3.1350
## Cadillac Fleetwood     5.4495        5.2848     6.7702         4.6845
## Lincoln Continental    5.4800        5.3128     6.8197         4.7869
## Chrysler Imperial      5.0973        4.9356     6.5251         4.6034
## Fiat 128               4.0243        3.9407     1.7832         4.1854
## Honda Civic            4.0533        4.0507     2.6459         5.2450
## Toyota Corolla         4.3445        4.2723     2.2120         4.5514
## Toyota Corona          4.3303        4.2137     2.5743         2.1359
## Dodge Challenger       4.1090        4.0530     5.1795         3.1033
## AMC Javelin            3.7602        3.6847     4.8499         2.9347
## Camaro Z28             4.1192        4.1051     5.9278         4.6740
## Pontiac Firebird       4.1721        4.0882     5.2719         3.1815
## Fiat X1-9              3.6111        3.5658     1.0647         3.9830
## Porsche 914-2          2.5949        2.6591     2.9669         5.3633
## Lotus Europa           3.5594        3.6429     2.3505         4.8655
## Ford Pantera L         3.6239        3.7005     5.6725         6.2183
## Ferrari Dino           2.2173        2.3107     4.6712         5.7255
## Maserati Bora          4.9758        5.0071     7.2893         7.4540
## Volvo 142E             2.9056        2.7880     0.9799         3.5836
##                     Hornet Sportabout Valiant Duster 360 Merc 240D Merc 230
## Mazda RX4 Wag                                                              
## Datsun 710                                                                 
## Hornet 4 Drive                                                             
## Hornet Sportabout                                                          
## Valiant                        3.3988                                      
## Duster 360                     1.8907  4.5959                              
## Merc 240D                      4.6075  2.9114     5.6208                   
## Merc 230                       5.3602  3.4091     6.3074    1.7677         
## Merc 280                       3.7603  3.3860     4.1159    2.3467   3.1737
## Merc 280C                      3.8405  3.2902     4.2017    2.3315   2.9644
## Merc 450SE                     1.2157  3.3739     1.7195    4.6101   5.2829
## Merc 450SL                     1.0582  3.2662     1.7484    4.4790   5.1386
## Merc 450SLC                    1.2772  3.2104     1.8280    4.5289   5.0939
## Cadillac Fleetwood             2.8840  4.6250     2.4964    6.0571   6.4720
## Lincoln Continental            2.9685  4.7409     2.4967    6.1201   6.5342
## Chrysler Imperial              2.6262  4.7150     2.1314    5.8475   6.3196
## Fiat 128                       5.8776  4.7311     6.9265    2.8477   3.4761
## Honda Civic                    6.5055  5.8853     7.2973    3.7433   4.2794
## Toyota Corolla                 6.2330  5.1097     7.2823    3.1877   3.6385
## Toyota Corona                  4.4095  2.5379     5.4587    1.8188   2.3602
## Dodge Challenger               1.0370  3.2050     2.1566    4.7682   5.5841
## AMC Javelin                    0.8360  3.1377     2.0925    4.4434   5.1708
## Camaro Z28                     2.3538  5.0149     1.0554    5.7074   6.3746
## Pontiac Firebird               0.5475  3.5076     1.9843    4.7857   5.5292
## Fiat X1-9                      5.6028  4.4965     6.5755    2.7366   3.4680
## Porsche 914-2                  5.5333  5.9049     6.1678    4.0696   4.9108
## Lotus Europa                   5.8906  5.4091     6.5673    3.6797   4.6691
## Ford Pantera L                 4.5705  6.6598     3.9757    6.3426   7.0038
## Ferrari Dino                   4.8737  6.0394     4.5054    5.2004   6.0348
## Maserati Bora                  5.7962  7.6982     4.5081    7.6029   8.1528
## Volvo 142E                     4.9105  4.0222     5.5903    2.4866   3.1933
##                     Merc 280 Merc 280C Merc 450SE Merc 450SL Merc 450SLC
## Mazda RX4 Wag                                                           
## Datsun 710                                                              
## Hornet 4 Drive                                                          
## Hornet Sportabout                                                       
## Valiant                                                                 
## Duster 360                                                              
## Merc 240D                                                               
## Merc 230                                                                
## Merc 280                                                                
## Merc 280C             0.4083                                            
## Merc 450SE            3.5037    3.5447                                  
## Merc 450SL            3.4252    3.4663     0.3944                       
## Merc 450SLC           3.4613    3.4572     0.4901     0.4173            
## Cadillac Fleetwood    4.8481    4.8076     2.3752     2.6192      2.4459
## Lincoln Continental   4.8652    4.8311     2.4148     2.6820      2.5174
## Chrysler Imperial     4.5332    4.5498     2.1302     2.3834      2.3303
## Fiat 128              4.1045    4.1942     6.1027     5.9177      6.0523
## Honda Civic           4.3522    4.4597     6.7429     6.5609      6.6876
## Toyota Corolla        4.4495    4.5273     6.4894     6.2849      6.4199
## Toyota Corona         3.0092    2.9592     4.5231     4.3467      4.3683
## Dodge Challenger      3.9899    4.0421     1.2054     1.1528      1.2247
## AMC Javelin           3.5714    3.6040     1.0549     0.9431      0.9627
## Camaro Z28            4.0283    4.1261     2.1735     2.2626      2.3169
## Pontiac Firebird      3.9725    4.0518     1.3039     1.2654      1.4563
## Fiat X1-9             3.7811    3.8552     5.8250     5.6428      5.7475
## Porsche 914-2         4.2060    4.3569     5.7510     5.6099      5.7483
## Lotus Europa          4.1266    4.3110     6.1481     5.9588      6.1321
## Ford Pantera L        4.7638    4.9017     4.6618     4.6521      4.7411
## Ferrari Dino          3.8958    4.0540     4.6304     4.5550      4.6718
## Maserati Bora         5.7612    5.8673     5.4445     5.4647      5.5262
## Volvo 142E            2.7802    2.8201     4.9480     4.8295      4.8807
##                     Cadillac Fleetwood Lincoln Continental Chrysler Imperial
## Mazda RX4 Wag                                                               
## Datsun 710                                                                  
## Hornet 4 Drive                                                              
## Hornet Sportabout                                                           
## Valiant                                                                     
## Duster 360                                                                  
## Merc 240D                                                                   
## Merc 230                                                                    
## Merc 280                                                                    
## Merc 280C                                                                   
## Merc 450SE                                                                  
## Merc 450SL                                                                  
## Merc 450SLC                                                                 
## Cadillac Fleetwood                                                          
## Lincoln Continental             0.2957                                      
## Chrysler Imperial               1.0635              0.9081                  
## Fiat 128                        7.7973              7.8459            7.4347
## Honda Civic                     8.3929              8.4235            7.9703
## Toyota Corolla                  8.2005              8.2527            7.8281
## Toyota Corona                   6.1485              6.2161            5.9697
## Dodge Challenger                2.8372              2.9549            2.8684
## AMC Javelin                     2.8989              2.9910            2.8183
## Camaro Z28                      2.8151              2.7412            2.2660
## Pontiac Firebird                2.5701              2.6556            2.3044
## Fiat X1-9                       7.5268              7.5797            7.2243
## Porsche 914-2                   7.3428              7.3626            6.9370
## Lotus Europa                    7.8314              7.8778            7.4656
## Ford Pantera L                  5.2909              5.2361            4.8165
## Ferrari Dino                    5.8053              5.8069            5.4554
## Maserati Bora                   5.6041              5.5359            5.2173
## Volvo 142E                      6.4043              6.4300            6.1099
##                     Fiat 128 Honda Civic Toyota Corolla Toyota Corona
## Mazda RX4 Wag                                                        
## Datsun 710                                                           
## Hornet 4 Drive                                                       
## Hornet Sportabout                                                    
## Valiant                                                              
## Duster 360                                                           
## Merc 240D                                                            
## Merc 230                                                             
## Merc 280                                                             
## Merc 280C                                                            
## Merc 450SE                                                           
## Merc 450SL                                                           
## Merc 450SLC                                                          
## Cadillac Fleetwood                                                   
## Lincoln Continental                                                  
## Chrysler Imperial                                                    
## Fiat 128                                                             
## Honda Civic           1.9243                                         
## Toyota Corolla        0.5758      1.7799                             
## Toyota Corona         3.1796      3.9646         3.4387              
## Dodge Challenger      6.1898      6.9208         6.5812        4.5624
## AMC Javelin           5.8509      6.4507         6.2194        4.1915
## Camaro Z28            6.9503      7.1027         7.2971        5.5641
## Pontiac Firebird      6.1150      6.7947         6.4857        4.6855
## Fiat X1-9             0.9440      1.8357         1.2632        2.8772
## Porsche 914-2         3.2195      2.9932         3.4110        4.6535
## Lotus Europa          2.3907      2.8623         2.5924        4.2446
## Ford Pantera L        6.6166      6.4835         6.9121        6.7110
## Ferrari Dino          5.4662      5.4860         5.7729        5.8353
## Maserati Bora         8.1808      8.1867         8.4802        8.0606
## Volvo 142E            2.1945      2.6127         2.6006        2.7535
##                     Dodge Challenger AMC Javelin Camaro Z28 Pontiac Firebird
## Mazda RX4 Wag                                                               
## Datsun 710                                                                  
## Hornet 4 Drive                                                              
## Hornet Sportabout                                                           
## Valiant                                                                     
## Duster 360                                                                  
## Merc 240D                                                                   
## Merc 230                                                                    
## Merc 280                                                                    
## Merc 280C                                                                   
## Merc 450SE                                                                  
## Merc 450SL                                                                  
## Merc 450SLC                                                                 
## Cadillac Fleetwood                                                          
## Lincoln Continental                                                         
## Chrysler Imperial                                                           
## Fiat 128                                                                    
## Honda Civic                                                                 
## Toyota Corolla                                                              
## Toyota Corona                                                               
## Dodge Challenger                                                            
## AMC Javelin                   0.7828                                        
## Camaro Z28                    2.7783      2.4813                            
## Pontiac Firebird              1.1943      1.1772     2.4529                 
## Fiat X1-9                     5.8525      5.4949     6.5789           5.8832
## Porsche 914-2                 5.8698      5.4886     6.0073           5.8050
## Lotus Europa                  6.1425      5.9214     6.6478           6.1639
## Ford Pantera L                5.0079      4.7275     3.6306           4.7027
## Ferrari Dino                  5.0081      4.8308     4.5054           5.0962
## Maserati Bora                 6.0178      5.9397     4.4569           5.8679
## Volvo 142E                    5.1510      4.7543     5.5100           5.1557
##                     Fiat X1-9 Porsche 914-2 Lotus Europa Ford Pantera L
## Mazda RX4 Wag                                                          
## Datsun 710                                                             
## Hornet 4 Drive                                                         
## Hornet Sportabout                                                      
## Valiant                                                                
## Duster 360                                                             
## Merc 240D                                                              
## Merc 230                                                               
## Merc 280                                                               
## Merc 280C                                                              
## Merc 450SE                                                             
## Merc 450SL                                                             
## Merc 450SLC                                                            
## Cadillac Fleetwood                                                     
## Lincoln Continental                                                    
## Chrysler Imperial                                                      
## Fiat 128                                                               
## Honda Civic                                                            
## Toyota Corolla                                                         
## Toyota Corona                                                          
## Dodge Challenger                                                       
## AMC Javelin                                                            
## Camaro Z28                                                             
## Pontiac Firebird                                                       
## Fiat X1-9                                                              
## Porsche 914-2          2.9044                                          
## Lotus Europa           2.1787        2.5614                            
## Ford Pantera L         6.2259        4.6929       5.5541               
## Ferrari Dino           5.1088        3.6306       4.2188         3.0648
## Maserati Bora          7.8703        6.5746       6.9847         3.0288
## Volvo 142E             1.6208        2.8882       2.6646         5.2160
##                     Ferrari Dino Maserati Bora
## Mazda RX4 Wag                                 
## Datsun 710                                    
## Hornet 4 Drive                                
## Hornet Sportabout                             
## Valiant                                       
## Duster 360                                    
## Merc 240D                                     
## Merc 230                                      
## Merc 280                                      
## Merc 280C                                     
## Merc 450SE                                    
## Merc 450SL                                    
## Merc 450SLC                                   
## Cadillac Fleetwood                            
## Lincoln Continental                           
## Chrysler Imperial                             
## Fiat 128                                      
## Honda Civic                                   
## Toyota Corolla                                
## Toyota Corona                                 
## Dodge Challenger                              
## AMC Javelin                                   
## Camaro Z28                                    
## Pontiac Firebird                              
## Fiat X1-9                                     
## Porsche 914-2                                 
## Lotus Europa                                  
## Ford Pantera L                                
## Ferrari Dino                                  
## Maserati Bora             3.3720              
## Volvo 142E                4.2490        6.7446</code></pre>
<p>Hierarchical Clustering -dist() 用<code>dist()</code>函數計算距離，使用method=“”設定計算距離的依據，可用方法包括： “euclidean”, “maximum”, “manhattan”, “canberra”, “binary” or “minkowski”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d&lt;-<span class="kw">dist</span>(mtcars.mxs, <span class="dt">method=</span><span class="st">&quot;manhattan&quot;</span>) <span class="co">#計算manhattan距離</span>
d</code></pre></div>
<pre><code>##                     Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive
## Mazda RX4 Wag          0.5740                                        
## Datsun 710             7.5307        7.4780                          
## Hornet 4 Drive        11.8673       11.2933     8.9891               
## Hornet Sportabout     11.2150       10.6410    15.4555         7.6572
## Valiant               13.3742       12.8002    10.4828         2.1721
## Duster 360            11.7820       11.8348    19.1258        11.5519
## Merc 240D             10.6741       10.1001     5.6193         6.6700
## Merc 230              11.2016       10.6276     6.2969         8.0648
## Merc 280               6.4428        5.8688     7.9461         6.9357
## Merc 280C              7.0109        6.4369     8.1672         6.8322
## Merc 450SE            11.3772       10.8032    16.4306         8.3705
## Merc 450SL            10.9923       10.4183    15.8219         7.7618
## Merc 450SLC           11.6157       11.0417    15.9976         7.9375
## Cadillac Fleetwood    15.4937       14.9197    21.1362        13.0761
## Lincoln Continental   15.5001       14.9261    21.3217        13.2615
## Chrysler Imperial     14.1093       13.5353    20.3786        12.8795
## Fiat 128              10.6008       10.5481     3.2571        11.3173
## Honda Civic           11.5343       11.4815     5.5295        14.5186
## Toyota Corolla        11.8011       11.7484     4.4574        12.5176
## Toyota Corona         11.4343       11.3815     4.9433         4.6838
## Dodge Challenger      11.7697       11.3636    16.1781         8.1179
## AMC Javelin           11.1309       10.5569    15.0580         7.2597
## Camaro Z28            11.4113       11.4641    18.7550        13.1262
## Pontiac Firebird      12.0164       11.4424    16.2233         8.1632
## Fiat X1-9              9.7041        9.6513     2.3604        11.0249
## Porsche 914-2          6.7567        7.0620     6.9555        15.7461
## Lotus Europa           9.4453        9.5269     5.5626        13.7566
## Ford Pantera L         9.3827        9.4354    16.9134        18.5443
## Ferrari Dino           5.0926        5.3600    12.1942        15.6059
## Maserati Bora         13.0517       13.1044    20.3954        20.7747
## Volvo 142E             6.4917        6.1118     2.1517         9.0594
##                     Hornet Sportabout Valiant Duster 360 Merc 240D Merc 230
## Mazda RX4 Wag                                                              
## Datsun 710                                                                 
## Hornet 4 Drive                                                             
## Hornet Sportabout                                                          
## Valiant                        8.4734                                      
## Duster 360                     3.8947 12.1281                              
## Merc 240D                     12.8272  7.5370    16.4974                   
## Merc 230                      14.2219  8.6855    17.8922    2.8883         
## Merc 280                      10.2477  7.3853    11.4415    5.9162   6.4507
## Merc 280C                     10.6499  6.9168    11.5450    5.8128   6.3472
## Merc 450SE                     2.7592  8.9093     4.2408   13.8023  15.1971
## Merc 450SL                     2.3743  8.3006     4.1546   13.1936  14.5883
## Merc 450SLC                    2.9977  8.4763     4.0811   13.3693  14.7640
## Cadillac Fleetwood             6.7552 13.0912     5.5724   18.5079  19.9026
## Lincoln Continental            6.7616 13.5385     5.2871   18.6933  20.0881
## Chrysler Imperial              5.6700 13.4558     3.6663   17.7502  19.1450
## Fiat 128                      18.7126 12.7774    22.3829    6.5953   8.3297
## Honda Civic                   19.6461 16.0124    23.3163    8.4753  10.3264
## Toyota Corolla                19.9129 13.4965    23.5832    7.2852   9.0487
## Toyota Corona                 12.0791  5.5396    15.7494    3.9460   5.1152
## Dodge Challenger               2.1296  7.4972     4.6309   13.5497  14.9445
## AMC Javelin                    1.5590  7.8870     4.2922   12.4296  13.8244
## Camaro Z28                     5.6304 13.7025     1.7357   16.2763  17.5214
## Pontiac Firebird               0.9673  9.1045     4.5963   13.5950  14.9897
## Fiat X1-9                     17.8159 12.5186    21.4861    6.3365   8.0709
## Porsche 914-2                 15.2266 17.2399    18.5387   10.5488  11.5539
## Lotus Europa                  17.1177 15.3962    20.6536    9.1135  10.5630
## Ford Pantera L                11.4923 19.6214     8.3611   18.9326  19.4261
## Ferrari Dino                  12.6262 16.6814    12.4993   14.4599  15.7455
## Maserati Bora                 14.0696 21.3510    10.4072   21.7751  23.1699
## Volvo 142E                    14.2764 10.6698    17.9466    5.3827   5.7401
##                     Merc 280 Merc 280C Merc 450SE Merc 450SL Merc 450SLC
## Mazda RX4 Wag                                                           
## Datsun 710                                                              
## Hornet 4 Drive                                                          
## Hornet Sportabout                                                       
## Valiant                                                                 
## Duster 360                                                              
## Merc 240D                                                               
## Merc 230                                                                
## Merc 280                                                                
## Merc 280C             0.5681                                            
## Merc 450SE            9.9846   10.0881                                  
## Merc 450SL            9.3759    9.4794     0.6087                       
## Merc 450SLC           9.5516    9.6551     0.8313     0.6234            
## Cadillac Fleetwood   13.4520   13.5554     5.3547     5.7396      5.1386
## Lincoln Continental  13.6374   13.7409     5.3611     5.7460      5.3241
## Chrysler Imperial    12.6943   12.7978     4.5688     5.1552      4.9795
## Fiat 128             10.9414   10.8379    19.6878    19.0790     19.2547
## Honda Civic          11.8748   12.1966    20.6212    20.0125     20.1881
## Toyota Corolla       12.1417   12.0382    20.8881    20.2793     20.4550
## Toyota Corona         7.8416    7.7381    13.0543    12.4455     12.6212
## Dodge Challenger     10.9703   11.0738     2.9850     2.8988      2.9248
## AMC Javelin           9.8604    9.9639     2.3379     2.2516      2.1782
## Camaro Z28           11.0708   11.1743     5.2633     5.4019      5.2262
## Pontiac Firebird     11.0156   11.5836     2.6033     2.4534      2.9746
## Fiat X1-9            10.0446    9.9411    18.7910    18.1823     18.3580
## Porsche 914-2        12.8561   13.4241    16.6270    16.2421     16.8655
## Lotus Europa         11.3401   11.9082    18.5181    18.1332     18.7566
## Ford Pantera L       13.5273   13.6308    11.9589    11.8727     11.9983
## Ferrari Dino         10.4182   10.9863    12.7884    12.4035     13.0269
## Maserati Bora        16.7192   16.8227    13.4637    13.3774     13.3039
## Volvo 142E            6.5051    6.7374    15.2515    14.6428     14.8185
##                     Cadillac Fleetwood Lincoln Continental Chrysler Imperial
## Mazda RX4 Wag                                                               
## Datsun 710                                                                  
## Hornet 4 Drive                                                              
## Hornet Sportabout                                                           
## Valiant                                                                     
## Duster 360                                                                  
## Merc 240D                                                                   
## Merc 230                                                                    
## Merc 280                                                                    
## Merc 280C                                                                   
## Merc 450SE                                                                  
## Merc 450SL                                                                  
## Merc 450SLC                                                                 
## Cadillac Fleetwood                                                          
## Lincoln Continental             0.6410                                      
## Chrysler Imperial               2.3078              1.8284                  
## Fiat 128                       24.3933             24.5788           23.6357
## Honda Civic                    25.3268             25.5122           24.5691
## Toyota Corolla                 25.5936             25.7791           24.8360
## Toyota Corona                  17.7598             17.9453           17.0022
## Dodge Challenger                6.8364              7.1046            6.5741
## AMC Javelin                     6.8393              6.8457            5.7542
## Camaro Z28                      6.4244              6.1391            4.7753
## Pontiac Firebird                5.9538              5.9602            5.1304
## Fiat X1-9                      23.4966             23.6820           22.7389
## Porsche 914-2                  21.9817             21.9881           20.5973
## Lotus Europa                   23.8728             23.8792           22.4884
## Ford Pantera L                 13.9335             13.6482           11.8198
## Ferrari Dino                   16.9049             16.9113           15.5205
## Maserati Bora                  15.9796             15.6943           13.8660
## Volvo 142E                     19.9571             20.1426           19.1995
##                     Fiat 128 Honda Civic Toyota Corolla Toyota Corona
## Mazda RX4 Wag                                                        
## Datsun 710                                                           
## Hornet 4 Drive                                                       
## Hornet Sportabout                                                    
## Valiant                                                              
## Duster 360                                                           
## Merc 240D                                                            
## Merc 230                                                             
## Merc 280                                                             
## Merc 280C                                                            
## Merc 450SE                                                           
## Merc 450SL                                                           
## Merc 450SLC                                                          
## Cadillac Fleetwood                                                   
## Lincoln Continental                                                  
## Chrysler Imperial                                                    
## Fiat 128                                                             
## Honda Civic           3.8986                                         
## Toyota Corolla        1.2003      3.7516                             
## Toyota Corona         7.2379     10.4728         7.9569              
## Dodge Challenger     19.4352     20.3686        20.6355       12.8017
## AMC Javelin          18.3151     19.2485        19.5154       11.6816
## Camaro Z28           22.0121     22.9456        23.2124       15.4909
## Pontiac Firebird     19.4805     20.4139        20.6808       12.8470
## Fiat X1-9             1.4384      3.4937         2.0971        6.9791
## Porsche 914-2         7.9868      7.4884         8.5408       11.7035
## Lotus Europa          5.8443      5.5819         6.2985       10.0900
## Ford Pantera L       19.3102     19.7200        19.9868       20.8170
## Ferrari Dino         15.4514     16.3848        16.6517       15.5367
## Maserati Bora        23.6525     24.5859        24.8528       23.7379
## Volvo 142E            4.5485      5.4592         5.6365        6.0552
##                     Dodge Challenger AMC Javelin Camaro Z28 Pontiac Firebird
## Mazda RX4 Wag                                                               
## Datsun 710                                                                  
## Hornet 4 Drive                                                              
## Hornet Sportabout                                                           
## Valiant                                                                     
## Duster 360                                                                  
## Merc 240D                                                                   
## Merc 230                                                                    
## Merc 280                                                                    
## Merc 280C                                                                   
## Merc 450SE                                                                  
## Merc 450SL                                                                  
## Merc 450SLC                                                                 
## Cadillac Fleetwood                                                          
## Lincoln Continental                                                         
## Chrysler Imperial                                                           
## Fiat 128                                                                    
## Honda Civic                                                                 
## Toyota Corolla                                                              
## Toyota Corona                                                               
## Dodge Challenger                                                            
## AMC Javelin                   1.2197                                        
## Camaro Z28                    6.2053      5.8666                            
## Pontiac Firebird              2.6715      2.4927     5.7801                 
## Fiat X1-9                    18.5384     17.4183    21.1154          18.5837
## Porsche 914-2                15.7813     15.1424    18.1679          16.0280
## Lotus Europa                 17.7059     17.0335    20.2829          17.9191
## Ford Pantera L               12.3464     11.9335     7.5252          12.4596
## Ferrari Dino                 13.9101     13.2713    12.1595          13.4276
## Maserati Bora                14.1281     13.5635    10.2659          14.7712
## Volvo 142E                   14.9990     13.8789    17.5759          15.0442
##                     Fiat X1-9 Porsche 914-2 Lotus Europa Ford Pantera L
## Mazda RX4 Wag                                                          
## Datsun 710                                                             
## Hornet 4 Drive                                                         
## Hornet Sportabout                                                      
## Valiant                                                                
## Duster 360                                                             
## Merc 240D                                                              
## Merc 230                                                               
## Merc 280                                                               
## Merc 280C                                                              
## Merc 450SE                                                             
## Merc 450SL                                                             
## Merc 450SLC                                                            
## Cadillac Fleetwood                                                     
## Lincoln Continental                                                    
## Chrysler Imperial                                                      
## Fiat 128                                                               
## Honda Civic                                                            
## Toyota Corolla                                                         
## Toyota Corona                                                          
## Dodge Challenger                                                       
## AMC Javelin                                                            
## Camaro Z28                                                             
## Pontiac Firebird                                                       
## Fiat X1-9                                                              
## Porsche 914-2          6.9674                                          
## Lotus Europa           5.4346        5.2254                            
## Ford Pantera L        18.4135       12.2316      16.0298               
## Ferrari Dino          14.5546        8.8964      11.0113         8.0560
## Maserati Bora         22.7557       17.0976      19.2125         5.7847
## Volvo 142E             3.6517        6.6867       5.9981        14.7618
##                     Ferrari Dino Maserati Bora
## Mazda RX4 Wag                                 
## Datsun 710                                    
## Hornet 4 Drive                                
## Hornet Sportabout                             
## Valiant                                       
## Duster 360                                    
## Merc 240D                                     
## Merc 230                                      
## Merc 280                                      
## Merc 280C                                     
## Merc 450SE                                    
## Merc 450SL                                    
## Merc 450SLC                                   
## Cadillac Fleetwood                            
## Lincoln Continental                           
## Chrysler Imperial                             
## Fiat 128                                      
## Honda Civic                                   
## Toyota Corolla                                
## Toyota Corona                                 
## Dodge Challenger                              
## AMC Javelin                                   
## Camaro Z28                                    
## Pontiac Firebird                              
## Fiat X1-9                                     
## Porsche 914-2                                 
## Lotus Europa                                  
## Ford Pantera L                                
## Ferrari Dino                                  
## Maserati Bora             8.2011              
## Volvo 142E               11.0356       19.2163</code></pre>
<p>Hierarchical Clustering -hclust() 用<code>hclust</code>函數畫圖，必要參數是個觀察職的距離（可用<code>dist()</code>函數計算）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
hc&lt;-<span class="kw">hclust</span>(<span class="kw">dist</span>(mtcars.mxs)) <span class="co">#可用method參數設定聚合方法，預設為complete</span>
<span class="kw">plot</span>(hc)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-176-1.png" width="576" /></p>
<p>Hierarchical Clustering -hclust() 用<code>hclust</code>函數畫圖，必要參數是個觀察職的距離（可用<code>dist()</code>函數計算）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
hc&lt;-<span class="kw">hclust</span>(<span class="kw">dist</span>(mtcars.mxs),<span class="dt">method=</span><span class="st">&quot;average&quot;</span>) <span class="co">#聚合方法為計算平均距離</span>
<span class="kw">plot</span>(hc)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-177-1.png" width="576" /></p>
<p>Hierarchical Clustering -cutree()</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusterCut &lt;-<span class="st"> </span><span class="kw">cutree</span>(hc, <span class="dt">k=</span><span class="dv">5</span>) <span class="co">#分5群</span>
<span class="kw">sort</span>(clusterCut)</code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag       Porsche 914-2        Ferrari Dino 
##                   1                   1                   1                   1 
##          Datsun 710            Fiat 128         Honda Civic      Toyota Corolla 
##                   2                   2                   2                   2 
##           Fiat X1-9        Lotus Europa          Volvo 142E      Hornet 4 Drive 
##                   2                   2                   2                   3 
##             Valiant           Merc 240D            Merc 230            Merc 280 
##                   3                   3                   3                   3 
##           Merc 280C       Toyota Corona   Hornet Sportabout          Duster 360 
##                   3                   3                   4                   4 
##          Merc 450SE          Merc 450SL         Merc 450SLC  Cadillac Fleetwood 
##                   4                   4                   4                   4 
## Lincoln Continental   Chrysler Imperial    Dodge Challenger         AMC Javelin 
##                   4                   4                   4                   4 
##          Camaro Z28    Pontiac Firebird      Ford Pantera L       Maserati Bora 
##                   4                   4                   5                   5</code></pre>
<p>HC- clusters &amp; variables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()+<span class="kw">geom_point</span>(<span class="dt">data=</span>mtcars,
                    <span class="kw">aes</span>(<span class="dt">x=</span>hp,<span class="dt">y=</span>mpg,<span class="dt">color=</span><span class="kw">as.factor</span>(clusterCut)))</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-179-1.png" width="576" /></p>
<p>Hierarchical Clustering -cutree(),2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusterCut &lt;-<span class="st"> </span><span class="kw">cutree</span>(hc,<span class="dt">h =</span><span class="dv">4</span>) <span class="co">#切在高度=4的地方（距離=4）</span>
<span class="kw">sort</span>(clusterCut)</code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710            Fiat 128 
##                   1                   1                   1                   1 
##         Honda Civic      Toyota Corolla           Fiat X1-9       Porsche 914-2 
##                   1                   1                   1                   1 
##        Lotus Europa        Ferrari Dino          Volvo 142E      Hornet 4 Drive 
##                   1                   1                   1                   2 
##             Valiant           Merc 240D            Merc 230            Merc 280 
##                   2                   2                   2                   2 
##           Merc 280C       Toyota Corona   Hornet Sportabout          Duster 360 
##                   2                   2                   3                   3 
##          Merc 450SE          Merc 450SL         Merc 450SLC  Cadillac Fleetwood 
##                   3                   3                   3                   3 
## Lincoln Continental   Chrysler Imperial    Dodge Challenger         AMC Javelin 
##                   3                   3                   3                   3 
##          Camaro Z28    Pontiac Firebird      Ford Pantera L       Maserati Bora 
##                   3                   3                   4                   4</code></pre>
<p>Cluster the data -heatmap(),2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.2</span>,<span class="dv">4</span>),<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="kw">heatmap</span>(mtcars.mxs)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-181-1.png" width="576" /></p>
<p>Hierarchical clustering - hclust</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distxy &lt;-<span class="st"> </span><span class="kw">dist</span>(mtcars.mxs)
hClustering &lt;-<span class="st"> </span><span class="kw">hclust</span>(distxy)
<span class="kw">plot</span>(hClustering)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-182-1.png" width="384" /></p>
<p>Hierarchical clustering: summary - 可快速瀏覽觀察值與各欄位的關係</p>
<ul>
<li>分群結果可能被以下參數影響：
<ul>
<li>計算距離的方法</li>
<li>分群依據</li>
<li>更改數值的大小</li>
</ul></li>
<li>可能會遇到的問題：
<ul>
<li>有時會不太清楚要如何切割分群結果</li>
</ul></li>
</ul>
</div>
<div id="k-means-clustering" class="section level2">
<h2><span class="header-section-number">9.3</span> K-means clustering</h2>
<ul>
<li>執行步驟
<ul>
<li>指定要分幾群</li>
<li>計算每一群的中心點</li>
<li>將各個物件/觀察值指定給最近的中心點</li>
<li>依照新的分群計算新的中心點</li>
</ul></li>
<li>輸入
<ul>
<li>計算距離的資料（數值）</li>
<li>要分成幾群 # of clusters</li>
<li>預設個群的中間點位置</li>
</ul></li>
<li>產出
<ul>
<li>計算出每’群‘的中心點</li>
<li>指定每個觀察值所在的’群‘</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x&lt;-<span class="kw">scale</span>(mtcars$hp[-<span class="dv">1</span>]);y&lt;-<span class="kw">scale</span>(mtcars$mpg[-<span class="dv">1</span>])
<span class="kw">plot</span>(x,y,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">cex=</span><span class="dv">2</span>)
<span class="kw">text</span>(x<span class="fl">+0.05</span>,y<span class="fl">+0.05</span>,<span class="dt">labels=</span>labelCar)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-183-1.png" width="576" /></p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-184-1.png" width="480" /></p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-185-1.png" width="480" /></p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-186-1.png" width="480" /></p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-187-1.png" width="480" /></p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-188-1.png" width="480" /></p>
</div>
<div id="kmeans" class="section level2">
<h2><span class="header-section-number">9.4</span> <code>kmeans()</code></h2>
<ul>
<li>Important parameters: <code>x</code>, <code>centers</code>, <code>iter.max</code>, <code>nstart</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataFrame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x,y)
kmeansObj &lt;-<span class="st"> </span><span class="kw">kmeans</span>(dataFrame,<span class="dt">centers=</span><span class="dv">3</span>)
<span class="kw">names</span>(kmeansObj)</code></pre></div>
<pre><code>## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;     &quot;tot.withinss&quot;
## [6] &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;         &quot;ifault&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kmeansObj$cluster</code></pre></div>
<pre><code>##  [1] 1 1 1 3 1 3 1 1 1 1 3 3 3 3 3 3 2 2 2 1 3 3 3 3 2 2 2 3 3 3 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.2</span>,<span class="dv">4</span>))
<span class="kw">plot</span>(x,y,<span class="dt">col=</span>kmeansObj$cluster,<span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">cex=</span><span class="dv">2</span>)
<span class="kw">points</span>(kmeansObj$centers,<span class="dt">col=</span><span class="dv">1</span>:<span class="dv">3</span>,<span class="dt">pch=</span><span class="dv">3</span>,<span class="dt">cex=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-189-1.png" width="384" /></p>
<div id="heatmaps" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Heatmaps</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
dataMatrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dataFrame)[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">12</span>),]
kmeansObj &lt;-<span class="st"> </span><span class="kw">kmeans</span>(dataMatrix,<span class="dt">centers=</span><span class="dv">3</span>)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))
<span class="kw">image</span>(<span class="kw">t</span>(dataMatrix)[,<span class="kw">nrow</span>(dataMatrix):<span class="dv">1</span>],<span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">image</span>(<span class="kw">t</span>(dataMatrix)[,<span class="kw">order</span>(kmeansObj$cluster)],<span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-190-1.png" width="768" /></p>
</div>
<div id="k-means" class="section level3">
<h3><span class="header-section-number">9.4.2</span> K-means注意事項</h3>
<ul>
<li>需要決定# of clusters
<ul>
<li>用眼睛/人工/特殊要求選</li>
<li>用 cross validation/information theory選</li>
<li><a href="http://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set">Determining the number of clusters</a></li>
</ul></li>
<li>K-means 沒有一定的結果
<ul>
<li>不同的 # of clusters</li>
<li>不同的 # of iterations</li>
</ul></li>
</ul>
<p><code>kmeans()</code>, k=2</p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-191-1.png" width="384" /></p>
<p><code>kmeans()</code>, k=3</p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-192-1.png" width="384" /></p>
<p><code>kmeans()</code>, k=4</p>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-193-1.png" width="384" /></p>
<p>Use sum of squared error (SSE) scree plot to optimize the number of clusters</p>
<p>SSE: The sum of the squared distance between each member of a cluster and its cluster centroid.</p>
<p><a href="http://stackoverflow.com/questions/15376075/cluster-analysis-in-r-determine-the-optimal-number-of-clusters">參考資料</a></p>
<p><img src="Fig/SSE.png" width="500px"></p>
<p>SSE screen plot <code>withinss</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataMatrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(dataFrame)[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">12</span>),]
wss &lt;-<span class="st"> </span>(<span class="kw">nrow</span>(dataMatrix)-<span class="dv">1</span>)*<span class="kw">sum</span>(<span class="kw">apply</span>(dataMatrix,<span class="dv">2</span>,var))
for (i in <span class="dv">2</span>:(<span class="kw">nrow</span>(dataMatrix)-<span class="dv">1</span>)) {
    wss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">kmeans</span>(dataMatrix,<span class="dt">centers=</span>i)$withinss)
}
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co">#下,左,上,右</span>
<span class="kw">plot</span>(<span class="dv">1</span>:(<span class="kw">nrow</span>(dataMatrix)-<span class="dv">1</span>), wss, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Number of Clusters&quot;</span>,
     <span class="dt">ylab=</span><span class="st">&quot;Within groups sum of squares&quot;</span>)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-194-1.png" width="768" /></p>
</div>
</div>
<div id="machine-learning-" class="section level2">
<h2><span class="header-section-number">9.5</span> Machine Learning 機器學習</h2>
<p>什麼是Machine Learning？ - Learning from data - <code>Machine</code> learning from data <img src="Fig/ML.png" width="700px"></p>
<p>什麼是Machine Learning？ - 建立可以從<code>輸入資料</code>學習<code>新資訊</code>，變成<code>智慧</code>的演算法 - 演算法可以基於<code>輸入資料</code>，<code>預測事件</code>或<code>協助決策</code></p>
<ul>
<li>資料太<code>少</code>？<code>太髒</code>？–&gt;學不好</li>
</ul>
<p>Data —- <code>Machine Learning</code> —-&gt; Skill</p>
<p>Skill: 變準/變好/賺更多…etc</p>
<p>Machine Learning vs. Artificial Intelligence - ML: use data to compute something that improves performance - AI: compute something that shows <code>intelligent</code> behavior</p>
<p><code>ML</code> is one possible and popular route to realize <code>AI</code></p>
<p>Machine Learning無所不在 - 天氣預測 - 搜尋建議、購物建議 - 股市預測 - 臉部辨識、指紋辨識 - 垃圾郵件標記 - 尿布啤酒</p>
<p>什麼時候需要ML? - 有一些模式/模型可<code>學</code> - 很難定義這些模式/模型 - 有資料可<code>學</code>這些模式/模型</p>
<p>Machine Learning步驟 <img src="Fig/MLstep.jpg" width="700px"></p>
<p>Learning 種類 - Classification 分類 - 分兩類（P/N, Yes/No, M/F, Sick/Not sick） - 分多類 (A/B/C/D)</p>
<ul>
<li>Regression 迴歸
<ul>
<li>真實的’值’（股票、氣溫）</li>
</ul></li>
<li>Ranking
<ul>
<li>排序（Google page rank）</li>
</ul></li>
<li>Clustering
<ul>
<li>分群</li>
</ul></li>
</ul>
<p>Machine Learning 種類 -1</p>
<ul>
<li>Supervised learning 監督式學習
<ul>
<li>Regression 迴歸
<ul>
<li>Linear Regression 線性迴歸</li>
<li>Logistic Regression 羅吉斯迴歸、邏輯迴歸</li>
</ul></li>
<li>Classification 分類
<ul>
<li>Support Vector Machines 支持向量機</li>
<li>Decision Trees 決策樹</li>
<li>Neural Networks 神經網路</li>
<li>K-Nearest Neighbor</li>
</ul></li>
</ul></li>
</ul>
<p>Supervised learning 監督式學習 <img src="Fig/SupervisedLearning.png" width="700px"></p>
<p><a href="http://www.astroml.org/sklearn_tutorial/general_concepts.html">出處</a></p>
<p>Machine Learning 種類 -2 - Unsupervised learning 非監督式學習 - Clustering! 分群 - Hierarchical clustering 階層式分群 - K-means clustering - Association Rules 關聯式規則</p>
<p>Unsupervised learning 非監督式學習 <img src="Fig/UnsupervisedLearning.png" width="700px"></p>
<p><a href="http://www.astroml.org/sklearn_tutorial/general_concepts.html">出處</a></p>
<p>怎麼選Algorithms? <img src="Fig/MLCS.png" width="800px"></p>
<p>Regression Analysis 迴歸分析 了解兩個或多個變數間<code>是否相關</code>、<code>相關方向與強度</code>，並建立<code>數學模型</code>以便觀察特定變數來預測研究者感興趣的變數</p>
<ul>
<li>Linear Regression 線性迴歸</li>
<li>Logistic Regression 羅吉斯迴歸、邏輯迴歸</li>
</ul>
<p><a href="https://zh.wikipedia.org/wiki/%E8%BF%B4%E6%AD%B8%E5%88%86%E6%9E%90">Wiki</a></p>
<p>Linear Regression 線性迴歸 <img src="Fig/LR.jpg" width="700px"></p>
<p><a href="http://www2.cedarcrest.edu/academic/bio/hale/biostat/session24links/regression.html">出處</a></p>
<p>Logistic Regression 邏輯迴歸 <img src="Fig/LogR.png" width="800px"></p>
<p>Regression Analysis 迴歸分析</p>
<ul>
<li><code>Linear Regression 線性迴歸</code></li>
<li>Logistic Regression 羅吉斯迴歸、邏輯迴歸</li>
</ul>
<p>來用在NBA的資料看看！</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#讀入SportsAnalytics package</span>
if (!<span class="kw">require</span>(<span class="st">&#39;SportsAnalytics&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;SportsAnalytics&quot;</span>)
    <span class="kw">library</span>(SportsAnalytics)
}
<span class="co">#擷取2015-2016年球季球員資料</span>
NBA1516&lt;-<span class="kw">fetch_NBAPlayerStatistics</span>(<span class="st">&quot;15-16&quot;</span>)</code></pre></div>
<p>NBA<code>得分</code>與<code>上場分鐘數</code>的線性迴歸分析</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(NBA1516,<span class="kw">aes</span>(<span class="dt">x=</span>TotalMinutesPlayed,<span class="dt">y=</span>TotalPoints))+
<span class="st">    </span><span class="kw">geom_point</span>()+<span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>簡單線性迴歸分析- <code>glm()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># formula: Y~X1+X2+...+Xn  Y:依變項 X:自變項</span>
<span class="co"># data: 資料</span>
<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed,<span class="dt">data =</span>NBA1516)</code></pre></div>
<pre><code>## 
## Call:  glm(formula = TotalPoints ~ TotalMinutesPlayed, data = NBA1516)
## 
## Coefficients:
##        (Intercept)  TotalMinutesPlayed  
##            -85.907               0.493  
## 
## Degrees of Freedom: 475 Total (i.e. Null);  474 Residual
## Null Deviance:       99400000 
## Residual Deviance: 16700000  AIC: 6340</code></pre>
<p>TotalPoints = <code>0.4931</code> * TotalMinutesPlayed <code>-85.9071</code></p>
<p>其實<code>glm()</code>是廣義線性迴歸模型 - generalized linear models (glm) - 包括了線性迴歸模型和邏輯迴歸模型 - 線性模型也可用<code>lm()</code> - 如何修改預設模型？ - <code>family=&quot;gaussian&quot;</code> 線性模型模型 - <code>family=&quot;binomial&quot;</code> 邏輯迴歸模型 - <code>family=&quot;poisson&quot;</code> 卜瓦松迴歸模型</p>
<p>Gaussian distribution 高斯函數是<code>常態分布</code>的密度函數</p>
<p><img src="Fig/gaussian.gif" width="700px"></p>
<p>Binomial distribution 二項分布是<code>n個獨立的是/非試驗中成功的次數</code>的離散機率分布</p>
<p><img src="Fig/binomial.gif" width="650px"></p>
<p>Poisson distribution <code>次數</code>分佈</p>
<ul>
<li>某一服務設施在一定時間內受到的服務請求的次數</li>
<li>公車站的候客人數</li>
<li>機器故障數</li>
<li>自然災害發生的次數</li>
<li>DNA序列的變異數…..</li>
</ul>
<p><img src="Fig/poisson.png" width="300px"></p>
<p><code>得分</code>與<code>上場分鐘數</code>和<code>兩分球出手數</code>的關係 - 多變量線性迴歸分析</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># e+01: 10^1 / e-04: 10^(-4)</span>
<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted,
    <span class="dt">data =</span>NBA1516)</code></pre></div>
<pre><code>## 
## Call:  glm(formula = TotalPoints ~ TotalMinutesPlayed + FieldGoalsAttempted, 
##     data = NBA1516)
## 
## Coefficients:
##         (Intercept)   TotalMinutesPlayed  FieldGoalsAttempted  
##           -1.80e+01            -2.35e-04             1.26e+00  
## 
## Degrees of Freedom: 475 Total (i.e. Null);  473 Residual
## Null Deviance:       99400000 
## Residual Deviance: 2160000   AIC: 5370</code></pre>
<p>TotalPoints = <code>-0.0002347</code> * TotalMinutesPlayed + <code>1.255794</code> *FieldGoalsAttempted <code>-17.99</code></p>
<p><code>得分</code>與<code>上場分鐘數</code>和<code>兩分球出手數</code>和<code>守備位置</code>的關係 - 多變量線性迴歸分析</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted+Position,
    <span class="dt">data =</span>NBA1516)</code></pre></div>
<pre><code>## 
## Call:  glm(formula = TotalPoints ~ TotalMinutesPlayed + FieldGoalsAttempted + 
##     Position, data = NBA1516)
## 
## Coefficients:
##         (Intercept)   TotalMinutesPlayed  FieldGoalsAttempted  
##            22.85222             -0.00654              1.27572  
##          PositionPF           PositionPG           PositionSF  
##           -39.41633            -65.03465            -38.52230  
##          PositionSG  
##           -52.17514  
## 
## Degrees of Freedom: 474 Total (i.e. Null);  468 Residual
##   (1 observation deleted due to missingness)
## Null Deviance:       99100000 
## Residual Deviance: 1970000   AIC: 5320</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># e+01: 10^1 / e-04: 10^(-4)</span></code></pre></div>
<p>TotalPoints = <code>-0.0065</code> * TotalMinutesPlayed + <code>1.28</code> <em>FieldGoalsAttempted <code>+22.85</code> + <code>22.85</code> </em> PositionPF + <code>-65.03</code> * PositionPG + <code>-38.52</code> * PositionSF + <code>-52.18</code> * PositionSG</p>
<p>虛擬變項 Dummy Variable</p>
<ul>
<li>PositionPF? PositionPG? PositionSF? PositionSG?</li>
<li>如果是控球後衛（PG），會得到…
<ul>
<li>PositionPF=0</li>
<li>PositionPG=1</li>
<li>PositionSF=0</li>
<li>PositionSG=0</li>
</ul></li>
<li>中鋒去哪了？—基準項
<ul>
<li>PositionPF=0</li>
<li>PositionPG=0</li>
<li>PositionSF=0</li>
<li>PositionSG=0</li>
</ul></li>
</ul>
<p>多變量線性迴歸分析</p>
<ul>
<li>假設：各變數相互獨立！</li>
<li>若自變項X是類別變項，需要建立<code>虛擬變項</code></li>
<li>在R裡，<code>類別變項</code>請記得轉成factor，R會自動建立<code>虛擬變項</code></li>
<li>用在<code>依變數為連續變數</code>，<code>自變數為連續變數或虛擬變數</code>的場合</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(NBA1516$Position)</code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(NBA1516$Position)</code></pre></div>
<pre><code>## [1] &quot;C&quot;  &quot;PF&quot; &quot;PG&quot; &quot;SF&quot; &quot;SG&quot;</code></pre>
<p>用哪個計算比較準？</p>
<ul>
<li>可能不一定有適合的模型</li>
<li>常用的判斷準則
<ul>
<li>Akaike’s Information Criterion (AIC)</li>
<li>Bayesian Information Criterion (BIC)</li>
</ul></li>
<li>數值越小越好</li>
</ul>
<p>用哪個計算比較準？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OneVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed,<span class="dt">data =</span>NBA1516)
TwoVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted,
            <span class="dt">data =</span>NBA1516)
ThreeVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted+Position,
              <span class="dt">data =</span>NBA1516)
<span class="kw">c</span>(OneVar$aic,TwoVar$aic,ThreeVar$aic)</code></pre></div>
<pre><code>## [1] 6339 5367 5322</code></pre>
<p>所有參數都有用嗎？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum2&lt;-<span class="kw">summary</span>(TwoVar)
sum2$coefficients</code></pre></div>
<pre><code>##                       Estimate Std. Error  t value   Pr(&gt;|t|)
## (Intercept)         -1.799e+01   5.659758 -3.17833  1.578e-03
## TotalMinutesPlayed  -2.347e-04   0.009475 -0.02477  9.802e-01
## FieldGoalsAttempted  1.256e+00   0.022239 56.46683 2.474e-212</code></pre>
<p>所有參數都有用嗎？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum3&lt;-<span class="kw">summary</span>(ThreeVar)
sum3$coefficients</code></pre></div>
<pre><code>##                       Estimate Std. Error t value   Pr(&gt;|t|)
## (Intercept)          22.852223    9.01471  2.5350  1.157e-02
## TotalMinutesPlayed   -0.006537    0.00920 -0.7105  4.777e-01
## FieldGoalsAttempted   1.275721    0.02165 58.9325 1.145e-218
## PositionPF          -39.416327    9.93654 -3.9668  8.426e-05
## PositionPG          -65.034646   10.26925 -6.3329  5.649e-10
## PositionSF          -38.522299   10.48817 -3.6729  2.675e-04
## PositionSG          -52.175144    9.98533 -5.2252  2.625e-07</code></pre>
<p>Regression Analysis 迴歸分析</p>
<ul>
<li>Linear Regression 線性迴歸</li>
<li><code>Logistic Regression 羅吉斯迴歸</code></li>
</ul>
<p>Logistic Regression 羅吉斯迴歸</p>
<ul>
<li>用在<code>依變數為二元變數（非0即1）</code>的場合</li>
<li>生病/沒生病</li>
<li>錄取/不錄取</li>
<li><code>family=&quot;binomial&quot;</code> 邏輯迴歸模型</li>
</ul>
<p>為什麼錄取/不錄取？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://www.ats.ucla.edu/stat/data/binary.csv&quot;</span>)
<span class="co"># GRE:某考試成績, GPA:在校平均成績, rank:學校聲望</span>
<span class="kw">head</span>(mydata)</code></pre></div>
<pre><code>##   admit gre  gpa rank
## 1     0 380 3.61    3
## 2     1 660 3.67    3
## 3     1 800 4.00    1
## 4     1 640 3.19    4
## 5     0 520 2.93    4
## 6     1 760 3.00    2</code></pre>
<p>Hmm….</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata$rank &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$rank)
mylogit &lt;-<span class="st"> </span><span class="kw">glm</span>(admit ~<span class="st"> </span>gre +<span class="st"> </span>gpa +<span class="st"> </span>rank, 
               <span class="dt">data =</span> mydata, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
sum&lt;-<span class="kw">summary</span>(mylogit)
sum$coefficients</code></pre></div>
<pre><code>##              Estimate Std. Error z value  Pr(&gt;|z|)
## (Intercept) -3.989979   1.139951  -3.500 0.0004650
## gre          0.002264   0.001094   2.070 0.0384651
## gpa          0.804038   0.331819   2.423 0.0153879
## rank2       -0.675443   0.316490  -2.134 0.0328288
## rank3       -1.340204   0.345306  -3.881 0.0001039
## rank4       -1.551464   0.417832  -3.713 0.0002047</code></pre>
</div>
<div id="decision-trees-" class="section level2">
<h2><span class="header-section-number">9.6</span> Decision Trees 決策樹</h2>
<p>什麼是決策樹？ 在<code>樹狀目錄</code>中建立一系列分割，以建立模型。這些分割會表示成<code>「節點」(Node)</code>。每次發現輸入資料行與可預測資料行有明顯地相互關聯時，此演算法就會在模型中加入一個<code>節點</code>。演算法決定分岔的方式不同，視它預測連續資料行或分隔資料行而定。</p>
<p><img src="Fig/DT.png" width="500px"></p>
<p>決策樹的種類 - Classificaiton - Regression - Classification And Regression Tree (CART)</p>
<p>用籃板/三分/助攻/抄截來判斷位置</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (!<span class="kw">require</span>(<span class="st">&#39;rpart&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;rpart&quot;</span>)
    <span class="kw">library</span>(rpart)
}
DT&lt;-<span class="kw">rpart</span>(Position~Blocks+ThreesMade+Assists+Steals,<span class="dt">data=</span>NBA1516)
DT</code></pre></div>
<pre><code>## n=475 (1 observation deleted due to missingness)
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##   1) root 475 364 PF (0.15 0.23 0.21 0.18 0.23)  
##     2) ThreesMade&lt; 2.5 132  74 C (0.44 0.35 0.098 0.053 0.061)  
##       4) Blocks&gt;=4.5 89  37 C (0.58 0.38 0.011 0.011 0.011) *
##       5) Blocks&lt; 4.5 43  31 PF (0.14 0.28 0.28 0.14 0.16)  
##        10) Steals&lt; 2.5 29  19 PF (0.17 0.34 0.14 0.21 0.14) *
##        11) Steals&gt;=2.5 14   6 PG (0.071 0.14 0.57 0 0.21) *
##     3) ThreesMade&gt;=2.5 343 242 SG (0.035 0.19 0.25 0.23 0.29)  
##       6) Assists&gt;=170.5 96  39 PG (0.031 0.052 0.59 0.15 0.18) *
##       7) Assists&lt; 170.5 247 163 SG (0.036 0.24 0.12 0.26 0.34)  
##        14) Blocks&gt;=20.5 80  42 PF (0.062 0.48 0 0.26 0.2)  
##          28) Steals&lt; 59.5 58  21 PF (0.069 0.64 0 0.14 0.16) *
##          29) Steals&gt;=59.5 22   9 SF (0.045 0.045 0 0.59 0.32) *
##        15) Blocks&lt; 20.5 167  99 SG (0.024 0.13 0.17 0.26 0.41)  
##          30) Assists&lt; 81.5 110  68 SG (0.027 0.18 0.091 0.32 0.38)  
##            60) Blocks&gt;=4.5 63  39 SF (0.032 0.29 0.016 0.38 0.29)  
##             120) ThreesMade&lt; 13.5 19   9 PF (0.11 0.53 0 0.26 0.11) *
##             121) ThreesMade&gt;=13.5 44  25 SF (0 0.18 0.023 0.43 0.36)  
##               242) Blocks&lt; 9.5 17   7 SF (0 0.18 0.059 0.59 0.18) *
##               243) Blocks&gt;=9.5 27  14 SG (0 0.19 0 0.33 0.48) *
##            61) Blocks&lt; 4.5 47  23 SG (0.021 0.043 0.19 0.23 0.51) *
##          31) Assists&gt;=81.5 57  31 SG (0.018 0.035 0.33 0.16 0.46)  
##            62) ThreesMade&lt; 37 17   5 PG (0 0.12 0.71 0.059 0.12) *
##            63) ThreesMade&gt;=37 40  16 SG (0.025 0 0.17 0.2 0.6) *</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#控球後衛（PG）、得分後衛（SG）、小前鋒（SF）、大前鋒（PF）和中鋒（C）</span></code></pre></div>
<p>用籃板/三分/助攻/抄截來判斷位置</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="co">#下,左,上,右</span>
<span class="kw">plot</span>(DT)
<span class="kw">text</span>(DT, <span class="dt">use.n=</span>F, <span class="dt">all=</span>F, <span class="dt">cex=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-207-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#控球後衛（PG）、得分後衛（SG）、小前鋒（SF）、大前鋒（PF）和中鋒（C）</span></code></pre></div>
<p>用籃板/三分/助攻/抄截來判斷位置 預設的<code>plot()</code>真的太難用，改用<code>rpart.plot</code> package裡面的<code>prp()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (!<span class="kw">require</span>(<span class="st">&#39;rpart.plot&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;rpart.plot&quot;</span>)
    <span class="kw">library</span>(rpart.plot)
}
<span class="kw">prp</span>(DT)                 <span class="co"># Will plot the tree</span></code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<p>用籃板/三分/助攻/抄截來判斷位置</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prp</span>(DT)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<p>決策樹演算法怎麼決定<code>節點</code> - Gini impurity - Information gain - Variance reduction</p>
<p>…有機會再說吧……</p>
</div>
<div id="association-rules-" class="section level2">
<h2><span class="header-section-number">9.7</span> Association Rules 關聯式規則</h2>
<p>什麼是關聯式規則？ - 用於從大量數據中挖掘出有價值的數據項之間的相關關係 - 不考慮項目的次序，而僅考慮其組合 - <code>購物籃分析 (Market Basket Analysis)</code> - Apriori演算法是挖掘<code>布林關聯規則</code> (Boolean association rules) 頻繁項集的算法</p>
<p>Apriori演算法 <img src="Fig/apriori.png" width="700px"></p>
<p>超市資料分析：讀取資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the libraries</span>
if (!<span class="kw">require</span>(<span class="st">&#39;arules&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;arules&quot;</span>);<span class="kw">library</span>(arules) <span class="co">#for Apriori演算法</span>
}
if (!<span class="kw">require</span>(<span class="st">&#39;datasets&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;datasets&quot;</span>);<span class="kw">library</span>(datasets) <span class="co">#for Groceries data</span>
}
<span class="kw">data</span>(Groceries) <span class="co"># Load the data set</span>
Groceries@data@Dim <span class="co">#169 種商品，9835筆交易資料</span></code></pre></div>
<pre><code>## [1]  169 9835</code></pre>
<p>超市資料長這樣 <img src="Fig/groceries.png" width="700px"></p>
<p>超市資料分析：關聯式分析<code>apriori()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the rules</span>
rules &lt;-<span class="st"> </span><span class="kw">apriori</span>(Groceries, <span class="co"># data= Groceries</span>
                 <span class="dt">parameter =</span> <span class="kw">list</span>(<span class="dt">supp =</span> <span class="fl">0.001</span>, <span class="dt">conf =</span> <span class="fl">0.8</span>), <span class="co">#參數最低限度</span>
                 <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">verbose=</span>F)) <span class="co">#不要顯示output</span>
<span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">2</span>) <span class="co"># Only 2 digits</span>
<span class="kw">inspect</span>(rules[<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># Show the top 5 rules</span></code></pre></div>
<pre><code>##     lhs                        rhs            support confidence lift
## [1] {liquor,red/blush wine} =&gt; {bottled beer} 0.0019  0.90       11.2
## [2] {curd,cereals}          =&gt; {whole milk}   0.0010  0.91        3.6
## [3] {yogurt,cereals}        =&gt; {whole milk}   0.0017  0.81        3.2
## [4] {butter,jam}            =&gt; {whole milk}   0.0010  0.83        3.3
## [5] {soups,bottled beer}    =&gt; {whole milk}   0.0011  0.92        3.6</code></pre>
<p>如何解讀模型 啤酒=&gt;尿布</p>
<ul>
<li><code>Support</code>: 一次交易中，包括規則內的物品的機率。買啤酒同時買尿布的機率。交集</li>
<li><code>Confidence</code>: 包含左邊物品A的交易也會包含右邊物品B的條件機率。在買了啤酒的顧客中，有買尿布的比例。</li>
<li><code>Lift</code>: 規則的信心比期望值高多少。（買了啤酒以後，有買尿布的機率）/（在所有顧客群中買尿布的機率）
<ul>
<li><code>lift</code>=1: items on the left and right are independent.</li>
</ul></li>
</ul>
<p><img src="Fig/support.png" width="700px"></p>
<p><img src="Fig/conf.png" width="250px"></p>
<p><img src="Fig/lift.png" width="400px"></p>
<p>列出最有關連的幾條規則</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rules&lt;-<span class="kw">sort</span>(rules, <span class="dt">by=</span><span class="st">&quot;confidence&quot;</span>, <span class="dt">decreasing=</span><span class="ot">TRUE</span>) <span class="co">#按照confidence排序</span>
<span class="kw">inspect</span>(rules[<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># Show the top 5 rules</span></code></pre></div>
<pre><code>##     lhs                     rhs          support confidence lift
## [1] {rice,                                                      
##      sugar}              =&gt; {whole milk}  0.0012          1  3.9
## [2] {canned fish,                                               
##      hygiene articles}   =&gt; {whole milk}  0.0011          1  3.9
## [3] {root vegetables,                                           
##      butter,                                                    
##      rice}               =&gt; {whole milk}  0.0010          1  3.9
## [4] {root vegetables,                                           
##      whipped/sour cream,                                        
##      flour}              =&gt; {whole milk}  0.0017          1  3.9
## [5] {butter,                                                    
##      soft cheese,                                               
##      domestic eggs}      =&gt; {whole milk}  0.0010          1  3.9</code></pre>
<p>特別針對某項商品，右邊 買了什麼東西的人，會買<code>牛奶</code>呢？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rulesR&lt;-<span class="kw">apriori</span>(<span class="dt">data=</span>Groceries, <span class="dt">parameter=</span><span class="kw">list</span>(<span class="dt">supp=</span><span class="fl">0.001</span>,<span class="dt">conf =</span> <span class="fl">0.08</span>), 
        <span class="dt">appearance =</span> <span class="kw">list</span>(<span class="dt">default=</span><span class="st">&quot;lhs&quot;</span>,<span class="dt">rhs=</span><span class="st">&quot;whole milk&quot;</span>), <span class="co">#設定右邊一定要是牛奶</span>
        <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">verbose=</span>F)) <span class="co">#不要顯示output</span>
rulesR&lt;-<span class="kw">sort</span>(rulesR, <span class="dt">decreasing=</span><span class="ot">TRUE</span>,<span class="dt">by=</span><span class="st">&quot;confidence&quot;</span>) <span class="co">#按照confidence排序</span>
<span class="kw">inspect</span>(rulesR[<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># Show the top 5 rules</span></code></pre></div>
<pre><code>##     lhs                     rhs          support confidence lift
## [1] {rice,                                                      
##      sugar}              =&gt; {whole milk}  0.0012          1  3.9
## [2] {canned fish,                                               
##      hygiene articles}   =&gt; {whole milk}  0.0011          1  3.9
## [3] {root vegetables,                                           
##      butter,                                                    
##      rice}               =&gt; {whole milk}  0.0010          1  3.9
## [4] {root vegetables,                                           
##      whipped/sour cream,                                        
##      flour}              =&gt; {whole milk}  0.0017          1  3.9
## [5] {butter,                                                    
##      soft cheese,                                               
##      domestic eggs}      =&gt; {whole milk}  0.0010          1  3.9</code></pre>
<p>特別針對某項商品，左邊 買了<code>牛奶</code>的人，會買什麼呢？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rulesL&lt;-<span class="kw">apriori</span>(<span class="dt">data=</span>Groceries, <span class="dt">parameter=</span><span class="kw">list</span>(<span class="dt">supp=</span><span class="fl">0.001</span>,<span class="dt">conf =</span> <span class="fl">0.15</span>,<span class="dt">minlen=</span><span class="dv">2</span>), 
        <span class="dt">appearance =</span> <span class="kw">list</span>(<span class="dt">default=</span><span class="st">&quot;rhs&quot;</span>,<span class="dt">lhs=</span><span class="st">&quot;whole milk&quot;</span>), <span class="co">#設定左邊一定要是牛奶</span>
        <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">verbose=</span>F)) <span class="co">#不要顯示output</span>
rulesL&lt;-<span class="kw">sort</span>(rulesL, <span class="dt">decreasing=</span><span class="ot">TRUE</span>,<span class="dt">by=</span><span class="st">&quot;confidence&quot;</span>) <span class="co">#按照confidence排序</span>
<span class="kw">inspect</span>(rulesL[<span class="dv">1</span>:<span class="dv">5</span>]) <span class="co"># Show the top 5 rules</span></code></pre></div>
<pre><code>##     lhs             rhs                support confidence lift
## [1] {whole milk} =&gt; {other vegetables} 0.075   0.29       1.5 
## [2] {whole milk} =&gt; {rolls/buns}       0.057   0.22       1.2 
## [3] {whole milk} =&gt; {yogurt}           0.056   0.22       1.6 
## [4] {whole milk} =&gt; {root vegetables}  0.049   0.19       1.8 
## [5] {whole milk} =&gt; {tropical fruit}   0.042   0.17       1.6</code></pre>
<p>規則視覺化</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (!<span class="kw">require</span>(<span class="st">&#39;arulesViz&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;arulesViz&quot;</span>); <span class="kw">library</span>(arulesViz)
} 
<span class="co">#Mac-&gt;http://planspace.org/2013/01/17/fix-r-tcltk-dependency-problem-on-mac/</span>
<span class="kw">plot</span>(rules,<span class="dt">method=</span><span class="st">&quot;graph&quot;</span>,<span class="dt">interactive=</span><span class="ot">TRUE</span>,<span class="dt">shading=</span><span class="ot">NA</span>) <span class="co">#會跑一陣子</span></code></pre></div>
<p><img src="Fig/arulesViz.png" width="400px"> <img src="Fig/arulesVizBig.png" width="300px"></p>
<div id="section-9.7.1" class="section level3">
<h3><span class="header-section-number">9.7.1</span> 參考資料</h3>
<ul>
<li>台大資工林軒田教授（田神）：
<ul>
<li><a href="www.coursera.org/course/ntumlone">Machine Learning Foundations</a></li>
<li><a href="www.coursera.org/course/ntumltwo">Machine Learning Techniques</a></li>
</ul></li>
<li><a href="http://www.salemmarafi.com/code/market-basket-analysis-with-r/">Market Basket Analysis with R</a></li>
</ul>
<p>模型驗證？！ - Training set, Development set: 讓演算法<code>學</code>到<code>知識</code> - Test set, Validation set: 驗證<code>學</code>的怎麼樣 - 通常會比例分配 - 2/3的資料設為<code>Training set</code> - 剩下的1/3做驗證<code>Test set</code></p>
<p><img src="Fig/SupervisedLearning.png" width="400px"></p>
<p>把NBA的資料讀入</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#讀入SportsAnalytics package</span>
if (!<span class="kw">require</span>(<span class="st">&#39;SportsAnalytics&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;SportsAnalytics&quot;</span>)
    <span class="kw">library</span>(SportsAnalytics)
}
<span class="co">#擷取2015-2016年球季球員資料</span>
NBA1516&lt;-<span class="kw">fetch_NBAPlayerStatistics</span>(<span class="st">&quot;15-16&quot;</span>)
NBA1516&lt;-NBA1516[<span class="kw">complete.cases</span>(NBA1516),]</code></pre></div>
</div>
</div>
<div id="regression-" class="section level2">
<h2><span class="header-section-number">9.8</span> Regression 迴歸</h2>
<p>哪個模型比較好？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OneVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed,<span class="dt">data =</span>NBA1516)
TwoVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted,
            <span class="dt">data =</span>NBA1516)
ThreeVar&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted+Position,
              <span class="dt">data =</span>NBA1516)
<span class="kw">c</span>(OneVar$aic,TwoVar$aic,ThreeVar$aic)</code></pre></div>
<pre><code>## [1] 6326 5356 5322</code></pre>
<p>好！？ - 以Training set來<code>選看起來最好的模型</code> - 用Test set來<code>驗證模型是不是真的很好</code> - 想像…..訓練出來題庫答得好的學生，寫到新題目不一定會寫！？</p>
<p>隨機抽樣？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">10</span>,<span class="dv">3</span>) <span class="co"># 從1到10，隨機取三個數字</span></code></pre></div>
<pre><code>## [1] 1 4 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(NBA1516),<span class="kw">nrow</span>(NBA1516)/<span class="dv">3</span>) <span class="co">#從第一行到最後一行，隨機取1/3行數</span></code></pre></div>
<pre><code>##   [1] 388 398   6 271 143  19 169 126 455 444 287 448 407  56 275 165 310 293
##  [19] 319 286 462 128  79  77 253 193 175 378  94 228 176 115 356 136  35 417
##  [37] 167 144 291 339 211 404  22 437 443 145 400 208 434 133 255 464 257 186
##  [55] 236 395 350 121 352 108 141 231  78 210 382 468 146  24 361 428 326  96
##  [73] 277 346 181  69 203 347  14 103 371 243 374 320  20 118 200 276 111 180
##  [91] 281  50 358 151  95 360 457 157 337 413 357 179  42 235 109 308 122 322
## [109]  11 198 449 392 177  81 184   4  32 466 195 416 263 380 212 252 164  76
## [127]  41 471 222 391 197 244 335 332  40  65  64 154 429 328  34 475 343 323
## [145]   2 460 325 430 113 100 321 300 354 359 174 199 254 338</code></pre>
<p>把NBA的資料分成Training 和 Test set</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NBA1516$Test&lt;-F <span class="co">#新增一個參數紀錄分組</span>
<span class="co">#隨機取1/3當Test set</span>
NBA1516[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(NBA1516),<span class="kw">nrow</span>(NBA1516)/<span class="dv">3</span>),]$Test&lt;-T 
<span class="co"># Training set : Test set球員數</span>
<span class="kw">c</span>(<span class="kw">sum</span>(NBA1516$Test==F),<span class="kw">sum</span>(NBA1516$Test==T)) </code></pre></div>
<pre><code>## [1] 317 158</code></pre>
<p>訓練一個多變數線性迴歸模型</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit&lt;-<span class="kw">glm</span>(TotalPoints~TotalMinutesPlayed+FieldGoalsAttempted+
<span class="st">             </span>Position+ThreesAttempted+FreeThrowsAttempted,
              <span class="dt">data =</span>NBA1516[NBA1516$Test==F,])
fit$aic</code></pre></div>
<pre><code>## [1] 3353</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit)$coefficients</code></pre></div>
<pre><code>##                     Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)          16.1576     8.7015     1.9  6.4e-02
## TotalMinutesPlayed   -0.0089     0.0081    -1.1  2.8e-01
## FieldGoalsAttempted   1.0018     0.0256    39.1 2.0e-121
## PositionPF          -22.6084     9.0825    -2.5  1.3e-02
## PositionPG          -48.4574    10.4378    -4.6  5.1e-06
## PositionSF          -24.1427    10.1412    -2.4  1.8e-02
## PositionSG          -39.0153    10.0900    -3.9  1.3e-04
## ThreesAttempted       0.2188     0.0341     6.4  5.3e-10
## FreeThrowsAttempted   0.7521     0.0408    18.4  1.2e-51</code></pre>
<p>逐步選擇模型 stepwise 後退學習：一開始先將所有參數加到模型裡，再一個一個拿掉</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS)
##根據AIC，做逐步選擇, 預設倒退學習 direction = &quot;backward&quot;
##trace=FALSE: 不要顯示步驟
finalModel_B&lt;-<span class="kw">stepAIC</span>(fit,<span class="dt">direction =</span> <span class="st">&quot;backward&quot;</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>) 
<span class="kw">summary</span>(finalModel_B)$coefficients</code></pre></div>
<pre><code>##                     Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)            12.40      7.996     1.6  1.2e-01
## FieldGoalsAttempted     0.98      0.019    52.9 7.0e-157
## PositionPF            -21.37      9.015    -2.4  1.8e-02
## PositionPG            -46.80     10.330    -4.5  8.4e-06
## PositionSF            -23.28     10.114    -2.3  2.2e-02
## PositionSG            -38.03     10.053    -3.8  1.9e-04
## ThreesAttempted         0.22      0.034     6.4  7.5e-10
## FreeThrowsAttempted     0.75      0.041    18.5  4.9e-52</code></pre>
<p>逐步選擇模型 stepwise 往前學習：一開始先做一個沒有參數的模型，再把參數一個一個加進去</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##根據AIC，做逐步選擇, 往前學習 direction = &quot;forward&quot;
finalModel_F&lt;-<span class="kw">stepAIC</span>(fit,<span class="dt">direction =</span> <span class="st">&quot;forward&quot;</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>) 
<span class="kw">summary</span>(finalModel_F)$coefficients</code></pre></div>
<pre><code>##                     Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)          16.1576     8.7015     1.9  6.4e-02
## TotalMinutesPlayed   -0.0089     0.0081    -1.1  2.8e-01
## FieldGoalsAttempted   1.0018     0.0256    39.1 2.0e-121
## PositionPF          -22.6084     9.0825    -2.5  1.3e-02
## PositionPG          -48.4574    10.4378    -4.6  5.1e-06
## PositionSF          -24.1427    10.1412    -2.4  1.8e-02
## PositionSG          -39.0153    10.0900    -3.9  1.3e-04
## ThreesAttempted       0.2188     0.0341     6.4  5.3e-10
## FreeThrowsAttempted   0.7521     0.0408    18.4  1.2e-51</code></pre>
<p>逐步選擇模型 stepwise 雙向學習：參數加加減減</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##根據AIC，做逐步選擇, 雙向學習 direction = &quot;both&quot;
finalModel_Both&lt;-<span class="kw">stepAIC</span>(fit,<span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>) 
<span class="kw">summary</span>(finalModel_Both)$coefficients</code></pre></div>
<pre><code>##                     Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)            12.40      7.996     1.6  1.2e-01
## FieldGoalsAttempted     0.98      0.019    52.9 7.0e-157
## PositionPF            -21.37      9.015    -2.4  1.8e-02
## PositionPG            -46.80     10.330    -4.5  8.4e-06
## PositionSF            -23.28     10.114    -2.3  2.2e-02
## PositionSG            -38.03     10.053    -3.8  1.9e-04
## ThreesAttempted         0.22      0.034     6.4  7.5e-10
## FreeThrowsAttempted     0.75      0.041    18.5  4.9e-52</code></pre>
<p>用Test set來評估模型好不好</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predictPoint&lt;-<span class="kw">predict</span>(finalModel_Both, <span class="co">#Test==T, test data</span>
                      <span class="dt">newdata =</span> NBA1516[NBA1516$Test==T,]) 
<span class="kw">cor</span>(<span class="dt">x=</span>predictPoint,<span class="dt">y=</span>NBA1516[NBA1516$Test==T,]$TotalPoints) <span class="co">#相關係數</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span>predictPoint,<span class="dt">y=</span>NBA1516[NBA1516$Test==T,]$TotalPoints) </code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-224-1.png" width="672" /></p>
</div>
<div id="logistic-regression-" class="section level2">
<h2><span class="header-section-number">9.9</span> Logistic Regression 邏輯迴歸</h2>
<p>把入學資料分成Training 和 Test set 注意：當答案有正反兩面時，<code>Level 1 要放正面答案</code>–&gt;有病/錄取…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydata &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://www.ats.ucla.edu/stat/data/binary.csv&quot;</span>)
mydata$admit &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$admit) <span class="co"># 類別變項要轉為factor</span>
mydata$rank &lt;-<span class="st"> </span><span class="kw">factor</span>(mydata$rank) <span class="co"># 類別變項要轉為factor</span>
mydata$Test&lt;-F <span class="co">#新增一個參數紀錄分組</span>
mydata[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(mydata),<span class="kw">nrow</span>(mydata)/<span class="dv">3</span>),]$Test&lt;-T <span class="co">#隨機取1/3當Test set</span>
<span class="kw">c</span>(<span class="kw">sum</span>(mydata$Test==F),<span class="kw">sum</span>(mydata$Test==T)) <span class="co"># Training set : Test set學生數</span></code></pre></div>
<pre><code>## [1] 267 133</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#修改一下factor的level: 改成Level 1為錄取，2為不錄取--&gt;Level 1 要放正面答案</span>
mydata$admit&lt;-<span class="kw">factor</span>(mydata$admit,<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</code></pre></div>
<p>逐步選擇最好的模型</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># GRE:某考試成績, GPA:在校平均成績, rank:學校聲望</span>
mylogit &lt;-<span class="st"> </span><span class="kw">glm</span>(admit ~<span class="st"> </span>gre +<span class="st"> </span>gpa +<span class="st"> </span>rank, 
               <span class="dt">data =</span> mydata[mydata$Test==F,], <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
finalFit&lt;-<span class="kw">stepAIC</span>(mylogit,<span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>) <span class="co"># 雙向逐步選擇模型</span>
<span class="kw">summary</span>(finalFit)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = admit ~ gre + gpa + rank, family = &quot;binomial&quot;, 
##     data = mydata[mydata$Test == F, ])
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.167  -1.063   0.612   0.876   1.701  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  3.82483    1.44297    2.65  0.00803 ** 
## gre         -0.00187    0.00129   -1.45  0.14834    
## gpa         -0.88405    0.42164   -2.10  0.03602 *  
## rank2        0.88805    0.39692    2.24  0.02526 *  
## rank3        1.49777    0.42011    3.57  0.00036 ***
## rank4        2.03509    0.52784    3.86  0.00012 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 332.54  on 266  degrees of freedom
## Residual deviance: 300.66  on 261  degrees of freedom
## AIC: 312.7
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>來預測一下新學生可不可以錄取</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AdmitProb&lt;-<span class="kw">predict</span>(finalFit, <span class="co"># 用Training set做的模型</span>
                   <span class="dt">newdata =</span> mydata[mydata$Test==T,], <span class="co">#Test==T, test data</span>
                   <span class="dt">type=</span><span class="st">&quot;response&quot;</span>) <span class="co">#結果為每個人被錄取的機率</span>
<span class="kw">head</span>(AdmitProb)</code></pre></div>
<pre><code>##    2   16   18   19   20   23 
## 0.82 0.73 0.67 0.27 0.64 0.84</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(AdmitProb&lt;<span class="fl">0.5</span>,mydata[mydata$Test==T,]$admit) <span class="co"># row,column</span></code></pre></div>
<pre><code>##        
##          1  0
##   FALSE 27 90
##   TRUE  10  6</code></pre>
<p>當答案是二元時：效能指標 - Sensitivity 敏感性 - Specificity 特異性 - Positive Predictive Value (PPV) 陽性預測值 - Negative Predictive Value (NPV) 陰性預測值</p>
<p>名詞解釋 <img src="Fig/Cond.png" width="600px"></p>
<ul>
<li>TP: 有病且預測也有病</li>
<li>TN: 沒病且預測也沒病</li>
<li>FP: 沒病但是預測有病</li>
<li>FN: 有病但預測沒病</li>
</ul>
<p>當答案是二元時：效能指標公式 <img src="Fig/para.png" width="400px"></p>
<ul>
<li>Sensitivity 敏感性：所有<code>真的有病</code>的人，被<code>預測有病</code>的比例</li>
<li>Specificity 特異性：所有<code>真的沒病</code>的人，被<code>預測沒病</code>的比例</li>
<li>Positive Predictive Value (PPV) 陽性預測值：所有被<code>預測有病</code>的人，<code>真的有病</code>的比例</li>
<li>Negative Predictive Value (NPV) 陰性預測值：所有被<code>預測沒病</code>的人，<code>真的沒病</code>的比例</li>
</ul>
<p>回想一下剛剛的驗證結果</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(AdmitProb&lt;<span class="fl">0.5</span>,mydata[mydata$Test==T,]$admit) <span class="co"># row,column</span></code></pre></div>
<pre><code>##        
##          1  0
##   FALSE 27 90
##   TRUE  10  6</code></pre>
<p><img src="Fig/para.png" width="500px"></p>
<p>計算預測效能參數</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AdmitProb&lt;-<span class="kw">predict</span>(finalFit,
                   <span class="dt">newdata =</span> mydata[mydata$Test==T,], <span class="co">#Test==T, test data</span>
                   <span class="dt">type=</span><span class="st">&quot;response&quot;</span>) <span class="co">#結果為每個人『不』被錄取的機率</span>
AdmitAns&lt;-<span class="kw">factor</span>(<span class="kw">ifelse</span>(AdmitProb&lt;<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))
<span class="kw">str</span>(AdmitAns)</code></pre></div>
<pre><code>##  Factor w/ 2 levels &quot;1&quot;,&quot;0&quot;: 2 2 2 1 2 2 2 2 2 2 ...
##  - attr(*, &quot;names&quot;)= chr [1:133] &quot;2&quot; &quot;16&quot; &quot;18&quot; &quot;19&quot; ...</code></pre>
<p>計算預測效能參數</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret) <span class="co"># install.packages(&quot;caret&quot;) #計算參數的packages</span>
<span class="kw">sensitivity</span>(AdmitAns,mydata[mydata$Test==T,]$admit)</code></pre></div>
<pre><code>## [1] 0.27</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">specificity</span>(AdmitAns,mydata[mydata$Test==T,]$admit)</code></pre></div>
<pre><code>## [1] 0.94</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posPredValue</span>(AdmitAns,mydata[mydata$Test==T,]$admit)</code></pre></div>
<pre><code>## [1] 0.62</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">negPredValue</span>(AdmitAns,mydata[mydata$Test==T,]$admit)</code></pre></div>
<pre><code>## [1] 0.77</code></pre>
</div>
<div id="decision-trees--1" class="section level2">
<h2><span class="header-section-number">9.10</span> Decision Trees 決策樹</h2>
<p>阻攻/籃板/三分/助攻/抄截判斷位置-訓練</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (!<span class="kw">require</span>(<span class="st">&#39;rpart&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;rpart&quot;</span>); <span class="kw">library</span>(rpart)
}
DT&lt;-<span class="kw">rpart</span>(Position~Blocks+TotalRebounds+ThreesMade+Assists+Steals,
          <span class="dt">data=</span>NBA1516[NBA1516$Test==F,]) <span class="co">#訓練組 Training set</span>
<span class="co">#控球後衛（PG）、得分後衛（SG）、小前鋒（SF）、大前鋒（PF）和中鋒（C）</span>
DT</code></pre></div>
<pre><code>## n= 317 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##   1) root 317 240 SG (0.15 0.24 0.18 0.19 0.24)  
##     2) ThreesMade&lt; 2.5 89  49 C (0.45 0.37 0.067 0.056 0.056)  
##       4) Blocks&gt;=17 46  15 C (0.67 0.33 0 0 0) *
##       5) Blocks&lt; 17 43  25 PF (0.21 0.42 0.14 0.12 0.12) *
##     3) ThreesMade&gt;=2.5 228 160 SG (0.039 0.18 0.23 0.24 0.31)  
##       6) Assists&gt;=1.7e+02 59  24 PG (0.034 0.068 0.59 0.17 0.14)  
##        12) TotalRebounds&gt;=3.6e+02 18  10 SF (0.11 0.22 0.11 0.44 0.11) *
##        13) TotalRebounds&lt; 3.6e+02 41   8 PG (0 0 0.8 0.049 0.15) *
##       7) Assists&lt; 1.7e+02 169 110 SG (0.041 0.22 0.1 0.26 0.37)  
##        14) TotalRebounds&gt;=2.8e+02 37  17 PF (0.054 0.54 0 0.32 0.081)  
##          28) Steals&lt; 54 20   2 PF (0 0.9 0 0.1 0) *
##          29) Steals&gt;=54 17   7 SF (0.12 0.12 0 0.59 0.18) *
##        15) TotalRebounds&lt; 2.8e+02 132  72 SG (0.038 0.14 0.13 0.24 0.45)  
##          30) Assists&lt; 74 87  53 SG (0.046 0.18 0.057 0.32 0.39)  
##            60) TotalRebounds&gt;=1.1e+02 31  17 SF (0.065 0.32 0 0.45 0.16)  
##             120) Steals&lt; 34 20  10 PF (0.1 0.5 0 0.3 0.1) *
##             121) Steals&gt;=34 11   3 SF (0 0 0 0.73 0.27) *
##            61) TotalRebounds&lt; 1.1e+02 56  27 SG (0.036 0.11 0.089 0.25 0.52) *
##          31) Assists&gt;=74 45  19 SG (0.022 0.044 0.27 0.089 0.58)  
##            62) ThreesMade&lt; 37 11   3 PG (0 0 0.73 0 0.27) *
##            63) ThreesMade&gt;=37 34  11 SG (0.029 0.059 0.12 0.12 0.68) *</code></pre>
<p>阻攻/籃板/三分/助攻/抄截判斷位置-訓練 預設的<code>plot()</code>真的太難用，改用<code>rpart.plot</code> package的<code>prp()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (!<span class="kw">require</span>(<span class="st">&#39;rpart.plot&#39;</span>)){
    <span class="kw">install.packages</span>(<span class="st">&quot;rpart.plot&quot;</span>); <span class="kw">library</span>(rpart.plot)
}
<span class="kw">prp</span>(DT) <span class="co"># 把決策樹畫出來</span></code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-232-1.png" width="672" /></p>
<p>阻攻/籃板/三分/助攻/抄截判斷位置-訓練</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prp</span>(DT)</code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-233-1.png" width="672" /></p>
<p>有批球員沒寫守備位置？–預測</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">posPred&lt;-<span class="kw">predict</span>(DT,<span class="dt">newdata=</span> NBA1516[NBA1516$Test==T,]) <span class="co">#Test==T, test data</span>
<span class="co"># 預設為class probabilities, type = &quot;prob&quot;</span>
<span class="kw">head</span>(posPred)</code></pre></div>
<pre><code>##       C   PF   PG    SF   SG
## 1  0.00 0.00 0.80 0.049 0.15
## 2  0.00 0.00 0.80 0.049 0.15
## 12 0.00 0.90 0.00 0.100 0.00
## 13 0.21 0.42 0.14 0.116 0.12
## 16 0.10 0.50 0.00 0.300 0.10
## 17 0.67 0.33 0.00 0.000 0.00</code></pre>
<p>有個人沒寫守備位置–對答案</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result&lt;-<span class="kw">cbind</span>(<span class="kw">round</span>(posPred,<span class="dt">digits =</span> <span class="dv">2</span>),
              NBA1516[NBA1516$Test==T,]$Name,
      <span class="kw">as.character</span>(NBA1516[NBA1516$Test==T,]$Position))
<span class="kw">head</span>(result)</code></pre></div>
<pre><code>##    C      PF     PG     SF     SG                          
## 1  &quot;0&quot;    &quot;0&quot;    &quot;0.8&quot;  &quot;0.05&quot; &quot;0.15&quot; &quot;Jose Calderon&quot;  &quot;PG&quot;
## 2  &quot;0&quot;    &quot;0&quot;    &quot;0.8&quot;  &quot;0.05&quot; &quot;0.15&quot; &quot;Eric Bledsoe&quot;   &quot;PG&quot;
## 12 &quot;0&quot;    &quot;0.9&quot;  &quot;0&quot;    &quot;0.1&quot;  &quot;0&quot;    &quot;Trey Lyles&quot;     &quot;PF&quot;
## 13 &quot;0.21&quot; &quot;0.42&quot; &quot;0.14&quot; &quot;0.12&quot; &quot;0.12&quot; &quot;Elijah Millsap&quot; &quot;SG&quot;
## 16 &quot;0.1&quot;  &quot;0.5&quot;  &quot;0&quot;    &quot;0.3&quot;  &quot;0.1&quot;  &quot;Kyle Singler&quot;   &quot;SF&quot;
## 17 &quot;0.67&quot; &quot;0.33&quot; &quot;0&quot;    &quot;0&quot;    &quot;0&quot;    &quot;Cole Aldrich&quot;   &quot;C&quot;</code></pre>
<p>有個人沒寫守備位置–預測-2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">posPredC&lt;-<span class="kw">predict</span>(DT,<span class="dt">newdata=</span> NBA1516[NBA1516$Test==T,],<span class="dt">type =</span> <span class="st">&quot;class&quot;</span>) 
<span class="co"># type = &quot;class&quot; 直接預測類別</span>
<span class="kw">head</span>(posPredC)</code></pre></div>
<pre><code>##  1  2 12 13 16 17 
## PG PG PF PF PF  C 
## Levels: C PF PG SF SG</code></pre>
<p>有個人沒寫守備位置–對答案-2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resultC&lt;-<span class="kw">cbind</span>(<span class="kw">as.character</span>(posPredC),NBA1516[NBA1516$Test==T,]$Name,
      <span class="kw">as.character</span>(NBA1516[NBA1516$Test==T,]$Position))
<span class="kw">head</span>(resultC)</code></pre></div>
<pre><code>##      [,1] [,2]             [,3]
## [1,] &quot;PG&quot; &quot;Jose Calderon&quot;  &quot;PG&quot;
## [2,] &quot;PG&quot; &quot;Eric Bledsoe&quot;   &quot;PG&quot;
## [3,] &quot;PF&quot; &quot;Trey Lyles&quot;     &quot;PF&quot;
## [4,] &quot;PF&quot; &quot;Elijah Millsap&quot; &quot;SG&quot;
## [5,] &quot;PF&quot; &quot;Kyle Singler&quot;   &quot;SF&quot;
## [6,] &quot;C&quot;  &quot;Cole Aldrich&quot;   &quot;C&quot;</code></pre>
<div id="section-9.10.1" class="section level3">
<h3><span class="header-section-number">9.10.1</span> 模型驗證</h3>
<ul>
<li>Training set, Development set: 讓演算法<code>學</code>到<code>知識</code></li>
<li>Test set, Validation set: 驗證<code>學</code>的怎麼樣</li>
<li>通常會比例分配
<ul>
<li>2/3的資料設為<code>Training set</code></li>
<li>剩下的1/3做驗證<code>Test set</code></li>
</ul></li>
<li>訓練模型時，只能看Training set，用Training set來選一個最好的模型</li>
<li>訓練模型時，不能偷看Test set，才是真正的<code>驗證</code></li>
</ul>
<p>一步一步建立預測模型—範例</p>
<p>完整的模型建立步驟範例 - 標題：以聲波撞擊礦石的回聲預測礦石是否為礦物 - 以Sonar, Mines vs. Rocks為例 - 不要直接複製貼上，請按照自己被分配到的資料集寫作業～</p>
<p>步驟1.1:讀資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;mlbench&quot;) # 此package內有很多dataset可練習</span>
<span class="kw">library</span>(mlbench)
<span class="kw">data</span>(Sonar) 
<span class="kw">str</span>(Sonar) <span class="co">#看一下資料型別，有沒有缺值，類別變項是不是factor</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    208 obs. of  61 variables:
##  $ V1   : num  0.02 0.0453 0.0262 0.01 0.0762 0.0286 0.0317 0.0519 0.0223 0.0164 ...
##  $ V2   : num  0.0371 0.0523 0.0582 0.0171 0.0666 0.0453 0.0956 0.0548 0.0375 0.0173 ...
##  $ V3   : num  0.0428 0.0843 0.1099 0.0623 0.0481 ...
##  $ V4   : num  0.0207 0.0689 0.1083 0.0205 0.0394 ...
##  $ V5   : num  0.0954 0.1183 0.0974 0.0205 0.059 ...
##  $ V6   : num  0.0986 0.2583 0.228 0.0368 0.0649 ...
##  $ V7   : num  0.154 0.216 0.243 0.11 0.121 ...
##  $ V8   : num  0.16 0.348 0.377 0.128 0.247 ...
##  $ V9   : num  0.3109 0.3337 0.5598 0.0598 0.3564 ...
##  $ V10  : num  0.211 0.287 0.619 0.126 0.446 ...
##  $ V11  : num  0.1609 0.4918 0.6333 0.0881 0.4152 ...
##  $ V12  : num  0.158 0.655 0.706 0.199 0.395 ...
##  $ V13  : num  0.2238 0.6919 0.5544 0.0184 0.4256 ...
##  $ V14  : num  0.0645 0.7797 0.532 0.2261 0.4135 ...
##  $ V15  : num  0.066 0.746 0.648 0.173 0.453 ...
##  $ V16  : num  0.227 0.944 0.693 0.213 0.533 ...
##  $ V17  : num  0.31 1 0.6759 0.0693 0.7306 ...
##  $ V18  : num  0.3 0.887 0.755 0.228 0.619 ...
##  $ V19  : num  0.508 0.802 0.893 0.406 0.203 ...
##  $ V20  : num  0.48 0.782 0.862 0.397 0.464 ...
##  $ V21  : num  0.578 0.521 0.797 0.274 0.415 ...
##  $ V22  : num  0.507 0.405 0.674 0.369 0.429 ...
##  $ V23  : num  0.433 0.396 0.429 0.556 0.573 ...
##  $ V24  : num  0.555 0.391 0.365 0.485 0.54 ...
##  $ V25  : num  0.671 0.325 0.533 0.314 0.316 ...
##  $ V26  : num  0.641 0.32 0.241 0.533 0.229 ...
##  $ V27  : num  0.71 0.327 0.507 0.526 0.7 ...
##  $ V28  : num  0.808 0.277 0.853 0.252 1 ...
##  $ V29  : num  0.679 0.442 0.604 0.209 0.726 ...
##  $ V30  : num  0.386 0.203 0.851 0.356 0.472 ...
##  $ V31  : num  0.131 0.379 0.851 0.626 0.51 ...
##  $ V32  : num  0.26 0.295 0.504 0.734 0.546 ...
##  $ V33  : num  0.512 0.198 0.186 0.612 0.288 ...
##  $ V34  : num  0.7547 0.2341 0.2709 0.3497 0.0981 ...
##  $ V35  : num  0.854 0.131 0.423 0.395 0.195 ...
##  $ V36  : num  0.851 0.418 0.304 0.301 0.418 ...
##  $ V37  : num  0.669 0.384 0.612 0.541 0.46 ...
##  $ V38  : num  0.61 0.106 0.676 0.881 0.322 ...
##  $ V39  : num  0.494 0.184 0.537 0.986 0.283 ...
##  $ V40  : num  0.274 0.197 0.472 0.917 0.243 ...
##  $ V41  : num  0.051 0.167 0.465 0.612 0.198 ...
##  $ V42  : num  0.2834 0.0583 0.2587 0.5006 0.2444 ...
##  $ V43  : num  0.282 0.14 0.213 0.321 0.185 ...
##  $ V44  : num  0.4256 0.1628 0.2222 0.3202 0.0841 ...
##  $ V45  : num  0.2641 0.0621 0.2111 0.4295 0.0692 ...
##  $ V46  : num  0.1386 0.0203 0.0176 0.3654 0.0528 ...
##  $ V47  : num  0.1051 0.053 0.1348 0.2655 0.0357 ...
##  $ V48  : num  0.1343 0.0742 0.0744 0.1576 0.0085 ...
##  $ V49  : num  0.0383 0.0409 0.013 0.0681 0.023 0.0264 0.0507 0.0285 0.0777 0.0092 ...
##  $ V50  : num  0.0324 0.0061 0.0106 0.0294 0.0046 0.0081 0.0159 0.0178 0.0439 0.0198 ...
##  $ V51  : num  0.0232 0.0125 0.0033 0.0241 0.0156 0.0104 0.0195 0.0052 0.0061 0.0118 ...
##  $ V52  : num  0.0027 0.0084 0.0232 0.0121 0.0031 0.0045 0.0201 0.0081 0.0145 0.009 ...
##  $ V53  : num  0.0065 0.0089 0.0166 0.0036 0.0054 0.0014 0.0248 0.012 0.0128 0.0223 ...
##  $ V54  : num  0.0159 0.0048 0.0095 0.015 0.0105 0.0038 0.0131 0.0045 0.0145 0.0179 ...
##  $ V55  : num  0.0072 0.0094 0.018 0.0085 0.011 0.0013 0.007 0.0121 0.0058 0.0084 ...
##  $ V56  : num  0.0167 0.0191 0.0244 0.0073 0.0015 0.0089 0.0138 0.0097 0.0049 0.0068 ...
##  $ V57  : num  0.018 0.014 0.0316 0.005 0.0072 0.0057 0.0092 0.0085 0.0065 0.0032 ...
##  $ V58  : num  0.0084 0.0049 0.0164 0.0044 0.0048 0.0027 0.0143 0.0047 0.0093 0.0035 ...
##  $ V59  : num  0.009 0.0052 0.0095 0.004 0.0107 0.0051 0.0036 0.0048 0.0059 0.0056 ...
##  $ V60  : num  0.0032 0.0044 0.0078 0.0117 0.0094 0.0062 0.0103 0.0053 0.0022 0.004 ...
##  $ Class: Factor w/ 2 levels &quot;M&quot;,&quot;R&quot;: 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
<p>在建立模型之前…別忘了基本的資料分析 在這次的作業內不用包含這個部分</p>
<p><code>探索性分析 Exploratory data analysis</code>，看看資料長怎麼樣</p>
<p>要是有一個參數可以完美的把礦物跟石頭分開，那就不用麻煩了…</p>
<p>探索性分析 Exploratory data analysis</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2);<span class="kw">library</span>(reshape2) <span class="co">#install.packages(c(&quot;ggplot2&quot;,&quot;reshape2&quot;))</span>
Sonar.m&lt;-<span class="kw">melt</span>(Sonar,<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Class&quot;</span>))
<span class="kw">ggplot</span>(Sonar.m)+<span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Class,<span class="dt">y=</span>value))+<span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(~variable, <span class="dt">nrow=</span><span class="dv">5</span>,<span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="co">#投影片太小了</span></code></pre></div>
<p><img src="DataAnalyticsWithR_files/figure-html/unnamed-chunk-239-1.png" width="672" /></p>
<p>步驟1.2: 資料前處理 - 缺值？ - 沒有缺值，不需要處理 - 答案種類？ - 類別變項叫<code>Class</code>，M: mine礦–&gt;+, R: rock–&gt;-，不需要處理 - 類別變項的型別是不是factor？ - 是，不需要處理 - 有沒有無關的參數？ - 沒有無關的參數，不需要處理</p>
<p>步驟2:分成訓練組與測試組 該怎麼分可以自己決定，1/3，1/5…都可以</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Sonar$Test&lt;-F <span class="co">#新增一個參數紀錄分組</span>
<span class="co">#隨機取1/3當Test set</span>
Sonar[<span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(Sonar),<span class="kw">nrow</span>(Sonar)/<span class="dv">3</span>),]$Test&lt;-T 
<span class="co"># 看一下 Training set : Test set 案例數</span>
<span class="kw">c</span>(<span class="kw">sum</span>(Sonar$Test==F),<span class="kw">sum</span>(Sonar$Test==T)) </code></pre></div>
<pre><code>## [1] 139  69</code></pre>
<p>步驟3:訓練模型 - 注意只能用<code>訓練組</code>的資料，<code>Test</code>參數==F，忘記可以看前面範例 - 數值自變項X很多，先用迴歸好了～ - 要解釋一下模型</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit&lt;-<span class="kw">glm</span>(Class~., Sonar[Sonar$Test==F,],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)
finalFit&lt;-<span class="kw">stepAIC</span>(fit,<span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>,<span class="dt">trace =</span> F)
<span class="kw">summary</span>(finalFit)$coefficients</code></pre></div>
<pre><code>##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)     1628     123856  0.0131     0.99
## V1             -8514    1141471 -0.0075     0.99
## V2            -17266    1280789 -0.0135     0.99
## V3             13756     955992  0.0144     0.99
## V7              4801     387527  0.0124     0.99
## V10            -1642     137698 -0.0119     0.99
## V12            -4359     330775 -0.0132     0.99
## V13             1955     187592  0.0104     0.99
## V16              441      50558  0.0087     0.99
## V22            -1201     111368 -0.0108     0.99
## V24            -2156     240319 -0.0090     0.99
## V25             2032     210573  0.0097     0.99
## V28            -1246      86572 -0.0144     0.99
## V31             1973     258156  0.0076     0.99
## V32            -1448     167640 -0.0086     0.99
## V36             1415     107357  0.0132     0.99
## V38              460      56073  0.0082     0.99
## V39            -1765     314966 -0.0056     1.00
## V40             2134     267936  0.0080     0.99
## V44            -3036     225453 -0.0135     0.99
## V49           -17643    1252782 -0.0141     0.99
## V50            35481    2485807  0.0143     0.99</code></pre>
<p>步驟4.1:用測試組驗證模型-預測</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MinePred&lt;-<span class="kw">predict</span>(finalFit,<span class="dt">newdata =</span> Sonar[Sonar$Test==T,])
MineAns&lt;-<span class="kw">ifelse</span>(MinePred&lt;<span class="fl">0.5</span>,<span class="st">&quot;M&quot;</span>,<span class="st">&quot;R&quot;</span>) <span class="co">#&lt;0.5: Level 1</span>
MineAns&lt;-<span class="kw">factor</span>(MineAns,<span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;R&quot;</span>))
MineAns</code></pre></div>
<pre><code>##   5   8  11  20  25  27  30  32  34  35  39  40  46  47  49  54  57  58  59  60 
##   R   M   R   M   R   M   M   R   M   R   M   M   M   M   R   R   R   R   M   M 
##  63  65  72  74  79  85  86  97  98 102 104 105 108 109 110 112 115 117 119 121 
##   R   R   R   M   M   M   M   R   R   M   R   M   M   R   M   R   R   R   R   R 
## 122 123 125 126 130 133 134 135 136 137 141 142 149 155 162 164 167 172 174 178 
##   M   M   M   R   R   R   R   R   M   R   R   R   R   R   R   M   R   R   M   R 
## 186 192 194 199 200 201 202 203 205 
##   R   M   R   M   R   R   R   M   M 
## Levels: M R</code></pre>
<p>步驟4.2:用測試組驗證模型-效能</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret) <span class="co"># install.packages(&quot;caret&quot;) #計算參數的packages</span>
<span class="kw">sensitivity</span>(MineAns,Sonar[Sonar$Test==T,]$Class)</code></pre></div>
<pre><code>## [1] 0.89</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">specificity</span>(MineAns,Sonar[Sonar$Test==T,]$Class)</code></pre></div>
<pre><code>## [1] 0.88</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posPredValue</span>(MineAns,Sonar[Sonar$Test==T,]$Class)</code></pre></div>
<pre><code>## [1] 0.83</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">negPredValue</span>(MineAns,Sonar[Sonar$Test==T,]$Class)</code></pre></div>
<pre><code>## [1] 0.93</code></pre>
<p>解釋範例 - 資料說明 此資料來源為UCI Machine Learning Repository。</p>
<p>記載礦物與石頭接受各個不同角度的聲波撞擊後，接收到的回聲數值，一共有60個參數，代表使用一特別角度的聲波撞擊礦石所得回聲。另外，分類結果為二元分類，包括礦物 (M) 與石頭 (R) 。</p>
<p>解釋範例 - 模型說明 使用聲波在不同角度撞擊<code>礦石</code>所得到的回聲資料，以邏輯迴歸建立模型預測礦石是否為礦物，經最佳化後，模型使用參數為V1 + V2 + V3 + V4 + V7 + V11 + V12 + V13 + V17 + V18 + V22 + V24 + V25 + V26 + V30 + V31 + V32 + V38 + V39 + V48 + V50 + V52 + V53 + V58 + V59，共25個參數，各參數代表從一特別角度所得的礦石回聲</p>
<p>解釋範例 - 預測效能說明 使用聲波在不同角度撞擊<code>礦石</code>所得到的回聲資料，以邏輯迴歸模型預測礦石是否為礦物，可得敏感度97%，特異性89%，陽性預測率89%，陰性預測率97%。</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="InteractiveGraphics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "Microsoft JhengHei",
"size": 2
},
"edit": {
"link": "https://github.com/yijutseng/DataAnalyticsWithRBook/edit/master/09-DataMining.Rmd",
"text": "Edit"
},
"download": ["DataAnalyticsWithR.pdf", "DataAnalyticsWithR.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
